import{j as e}from"./query-BJLVRUEZ.js";import{u as le,r as u,a as he}from"./router-BVXzBWz1.js";import{u as T,a as ce,b as Q,L as O,C as p,c as v,B,d as D,e as A,f as M,s as R,g as ue,h as de,i as oe,v as je,j as Y,k as ge,l as pe,m as Z,n as G,o as fe,M as ve,I as K,p as xe,q as ye,r as be,t as Ne}from"./admin-DUsXwUKW.js";const ee=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"})}),we=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),se=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),ke=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});function He(){const x=le(),[y,i]=u.useState(null),{data:a,isLoading:n}=T(),{data:t,isLoading:h}=ce(),{data:g}=Q((a==null?void 0:a.id)||""),b=[{label:"대시보드",href:"/student",icon:e.jsx(ee,{})},{label:"AI 채팅",href:"/student/chat",icon:e.jsx(we,{})},{label:"내 프로필",href:"/student/profile",icon:e.jsx(se,{})},{label:"활동 기록",href:"/student/history",icon:e.jsx(ke,{})}],d=r=>{switch(r){case"argumentation":return"논증 활동";case"discussion":return"토론 활동";case"experiment":return"실험 활동";default:return r}},_=r=>{switch(r){case"argumentation":return"info";case"discussion":return"warning";case"experiment":return"success";default:return"default"}};return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):e.jsxs(O,{title:`안녕하세요, ${(a==null?void 0:a.name)||"학생"}님!`,subtitle:"오늘도 즐거운 학습 되세요",sidebarItems:b,showSidebar:!0,children:[e.jsx("div",{className:"mb-8",children:e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(se,{})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a==null?void 0:a.name}),e.jsxs("p",{className:"text-gray-600",children:["학번: ",a==null?void 0:a.student_id]}),e.jsxs("p",{className:"text-gray-600",children:["반: ",(a==null?void 0:a.class_name)||"미지정"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(B,{variant:"success",children:"온라인"})})]})})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(t==null?void 0:t.length)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"사용 가능한 활동"})]})})}),e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(g==null?void 0:g.length)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI 채팅 기록"})]})})}),e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"0"}),e.jsx("p",{className:"text-sm text-gray-600",children:"완료한 활동"})]})})})]}),e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"사용 가능한 활동"})}),e.jsx(v,{children:h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"활동을 불러오는 중..."})]}):t&&t.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>i(r.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:r.title}),e.jsx(B,{variant:_(r.type),size:"sm",children:d(r.type)})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"진행률: 0%"}),e.jsx(M,{size:"sm",onClick:w=>{w.stopPropagation(),x(`/student/activity/${r.id}`)},children:"시작하기"})]})]},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{}),e.jsx("p",{className:"text-gray-500 mt-2",children:"현재 사용 가능한 활동이 없습니다."})]})})]}),g&&g.length>0&&e.jsxs(p,{className:"mt-6",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"최근 AI 채팅"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>x("/student/chat"),children:"전체 보기"})]})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:g.slice(-3).map(r=>e.jsxs("div",{className:"border-l-4 border-primary-200 pl-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:new Date(r.created_at).toLocaleString()}),e.jsx("p",{className:"text-gray-900 font-medium mb-2",children:r.message}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[r.response.substring(0,100),"..."]})]},r.id))})})]})]})}function me({activityId:x,className:y}){const[i,a]=u.useState(""),[n,t]=u.useState([]),[h,g]=u.useState(!1),[b,d]=u.useState(!1),_=u.useRef(null),r=u.useRef(null),{data:w}=T(),{data:z,isLoading:o}=Q((w==null?void 0:w.id)||"",x);u.useEffect(()=>{if(z){const f=[];z.forEach(S=>{f.push({id:`${S.id}-user`,content:S.message,isUser:!0,timestamp:S.created_at}),f.push({id:`${S.id}-ai`,content:S.response,isUser:!1,timestamp:S.created_at})}),t(f)}},[z]);const j=()=>{var f;(f=_.current)==null||f.scrollIntoView({behavior:"smooth"})};u.useEffect(()=>{j()},[n]);const k=async()=>{if(!i.trim()||!w||h)return;const f={id:`user-${Date.now()}`,content:i,isUser:!0,timestamp:new Date().toISOString()};t(L=>[...L,f]);const S=i;a(""),g(!0);const F={id:`ai-${Date.now()}`,content:"",isUser:!1,timestamp:new Date().toISOString(),isStreaming:!0};t(L=>[...L,F]);try{r.current=new AbortController;const L=await R.functions.invoke("ai-chat",{body:{message:S,studentId:w.id,activityId:x,useRag:b,stream:!1},signal:r.current.signal});if(L.error)throw new Error(L.error.message||"AI 응답 생성 중 오류가 발생했습니다.");t(P=>P.map(m=>m.id===F.id?{...m,content:L.data.response,isStreaming:!1}:m))}catch(L){console.error("Error sending message:",L);const P=L.name==="AbortError"?"메시지 전송이 취소되었습니다.":"죄송합니다. 메시지 전송 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.";t(m=>m.map(s=>s.id===F.id?{...s,content:P,isStreaming:!1}:s))}finally{g(!1),r.current=null}},$=()=>{r.current&&r.current.abort()},c=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),k())},C=()=>{window.confirm("채팅 기록을 모두 지우시겠습니까?")&&t([])};return o?e.jsx(p,{className:y,children:e.jsxs("div",{className:"flex items-center justify-center h-96",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"채팅 기록을 불러오는 중..."})]})}):e.jsx(p,{className:y,padding:"none",children:e.jsxs("div",{className:"flex flex-col h-96",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"AI 학습 도우미"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:f=>d(f.target.checked),className:"mr-1 h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),"문서 검색"]}),e.jsx(M,{variant:"outline",size:"sm",onClick:C,disabled:n.length===0,children:"기록 지우기"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("p",{className:"text-lg font-medium",children:"AI와 대화를 시작해보세요!"}),e.jsx("p",{className:"text-sm mt-2",children:"궁금한 것이 있으면 언제든 물어보세요."}),e.jsx("div",{className:"mt-4 text-xs text-gray-400",children:e.jsx("p",{children:"💡 팁: 구체적인 질문을 하면 더 도움이 되는 답변을 받을 수 있어요"})})]}):n.map(f=>e.jsx("div",{className:`flex ${f.isUser?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${f.isUser?"bg-primary-600 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsxs("div",{className:"text-sm whitespace-pre-wrap",children:[f.content,f.isStreaming&&e.jsx("span",{className:"inline-block w-2 h-4 bg-current animate-pulse ml-1"})]}),e.jsx("div",{className:"text-xs mt-1 opacity-70",children:new Date(f.timestamp).toLocaleTimeString()})]})},f.id)),e.jsx("div",{ref:_})]}),e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{value:i,onChange:f=>a(f.target.value),onKeyPress:c,placeholder:"메시지를 입력하세요...",className:"flex-1 resize-none border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100",rows:2,disabled:h,maxLength:1e3}),e.jsx("div",{className:"flex flex-col space-y-1",children:h?e.jsx(M,{onClick:$,variant:"outline",size:"sm",children:"취소"}):e.jsx(M,{onClick:k,disabled:!i.trim(),size:"sm",children:"전송"})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Enter로 전송, Shift+Enter로 줄바꿈"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[i.length,"/1000"]})]})]})]})})}function Ce({activityId:x,className:y}){const[i,a]=u.useState([]),[n,t]=u.useState(null),{data:h}=T(),{data:g,isLoading:b}=ue(x);u.useEffect(()=>{h&&g&&d()},[h,g]);const d=async()=>{if(!(!h||!g))try{const{data:o,error:j}=await R.from("student_checklist_progress").select("checklist_item_id, is_completed, completed_at").eq("student_id",h.id);if(j)throw j;const k=new Map((o==null?void 0:o.map(c=>[c.checklist_item_id,c]))||[]),$=g.map(c=>{const C=k.get(c.id);return{...c,is_completed:(C==null?void 0:C.is_completed)||!1,completed_at:C==null?void 0:C.completed_at}});a($)}catch(o){console.error("Error loading checklist progress:",o)}},_=async o=>{if(!(!h||n)){t(o);try{const j=i.find(C=>C.id===o);if(!j)return;const k=!j.is_completed,$=new Date().toISOString(),{error:c}=await R.from("student_checklist_progress").upsert({student_id:h.id,checklist_item_id:o,is_completed:k,completed_at:k?$:null});if(c)throw c;a(C=>C.map(f=>f.id===o?{...f,is_completed:k,completed_at:k?$:void 0}:f))}catch(j){console.error("Error updating checklist progress:",j),alert("체크리스트 업데이트 중 오류가 발생했습니다.")}finally{t(null)}}};if(b)return e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsx(A,{children:"체크리스트"})}),e.jsx(v,{children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(o=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},o))})})]});if(!g||g.length===0)return e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsx(A,{children:"체크리스트"})}),e.jsx(v,{children:e.jsx("p",{className:"text-gray-500 text-center py-8",children:"이 활동에는 체크리스트가 없습니다."})})]});const r=i.length,w=i.filter(o=>o.is_completed).length,z=r>0?w/r*100:0;return e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"체크리스트"}),e.jsxs(B,{variant:z===100?"success":"info",children:[w,"/",r," 완료"]})]})}),e.jsxs(v,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"진행률"}),e.jsxs("span",{children:[Math.round(z),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:{width:`${z}%`}})})]}),e.jsx("div",{className:"space-y-3",children:i.sort((o,j)=>o.order_index-j.order_index).map(o=>{const j=n===o.id;return e.jsxs("div",{className:`flex items-start space-x-3 p-3 rounded-lg border transition-colors ${o.is_completed?"bg-green-50 border-green-200":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("button",{onClick:()=>_(o.id),disabled:j,className:`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${o.is_completed?"bg-green-500 border-green-500 text-white":"border-gray-300 hover:border-primary-500"} ${j?"opacity-50 cursor-not-allowed":""}`,children:j?e.jsx("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"}):o.is_completed?e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):null}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:`font-medium ${o.is_completed?"text-green-900 line-through":"text-gray-900"}`,children:o.title}),o.is_required&&e.jsx(B,{variant:"error",size:"sm",children:"필수"})]}),o.description&&e.jsx("p",{className:`text-sm mt-1 ${o.is_completed?"text-green-700":"text-gray-600"}`,children:o.description}),o.completed_at&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["완료: ",new Date(o.completed_at).toLocaleString()]})]})]},o.id)})}),z===100&&e.jsx("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-green-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-green-800 font-medium",children:"모든 체크리스트를 완료했습니다! 🎉"})]})})]})]})}function _e({onFileProcessed:x,onFileUploaded:y,className:i,maxFiles:a=10,showPreview:n=!0}){const[t,h]=u.useState([]),[g,b]=u.useState(!1),[d,_]=u.useState(null),[r,w]=u.useState({}),z=u.useRef(null),{data:o}=T(),j=de(),k=oe(),$=u.useCallback(async s=>{if(!s||!o)return;const l=Array.from(s);if(t.length+l.length>a){alert(`최대 ${a}개의 파일만 업로드할 수 있습니다.`);return}for(const N of l){const W=je(N);if(!W.isValid){alert(`${N.name}: ${W.error}`);continue}const I=`file-${Date.now()}-${Math.random()}`;w(H=>({...H,[I]:0}));try{let H=N,U;if(Y(N.type))try{U=await ge(N),H=await pe(N,500),w(E=>({...E,[I]:20}))}catch(E){console.warn("Image processing failed, using original file:",E)}w(E=>({...E,[I]:50}));const V=await j.mutateAsync({file:H,studentId:o.id});w(E=>({...E,[I]:80}));const X={id:I,name:N.name,size:N.size,type:N.type,url:V.url,uploadedAt:new Date().toISOString(),processed:!1,thumbnail:U,category:c(N.type)};if(h(E=>[...E,X]),y==null||y(X),Z(N.type))try{w(E=>({...E,[I]:90})),await k.mutateAsync({fileUrl:V.url,fileName:N.name}),h(E=>E.map(q=>q.id===I?{...q,processed:!0}:q)),x==null||x(N.name)}catch(E){console.error("PDF processing error:",E),alert(`${N.name} PDF 처리 중 오류가 발생했습니다.`)}w(E=>({...E,[I]:100})),setTimeout(()=>{w(E=>{const q={...E};return delete q[I],q})},1e3)}catch(H){console.error("File upload error:",H),alert(`${N.name} 업로드 중 오류가 발생했습니다.`),w(U=>{const V={...U};return delete V[I],V})}}},[o,t.length,a,j,k,y,x]),c=s=>s.startsWith("image/")?"image":s.startsWith("audio/")?"audio":s.startsWith("video/")?"video":s.includes("pdf")||s.includes("document")||s.includes("text")?"document":"unknown",C=s=>{s.preventDefault(),b(!0)},f=s=>{s.preventDefault(),b(!1)},S=s=>{s.preventDefault(),b(!1),$(s.dataTransfer.files)},F=s=>{$(s.target.files),s.target.value=""},L=s=>{h(l=>l.filter(N=>N.id!==s)),w(l=>{const N={...l};return delete N[s],N})},P=s=>{G(s.type)&&_(s)},m=s=>{const l="w-8 h-8";switch(s.category){case"image":return s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-8 h-8 object-cover rounded"}):e.jsx("svg",{className:`${l} text-green-500`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})});case"document":return e.jsx("svg",{className:`${l} text-red-500`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})});case"audio":return e.jsx("svg",{className:`${l} text-purple-500`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM15.657 6.343a1 1 0 011.414 0A9.972 9.972 0 0119 12a9.972 9.972 0 01-1.929 5.657 1 1 0 11-1.414-1.414A7.971 7.971 0 0017 12a7.971 7.971 0 00-1.343-4.243 1 1 0 010-1.414z",clipRule:"evenodd"})});case"video":return e.jsx("svg",{className:`${l} text-blue-500`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zm12.553 1.106A1 1 0 0116 8v4a1 1 0 01-1.447.894l-2-1A1 1 0 0112 11V9a1 1 0 01.553-.894l2-1z",clipRule:"evenodd"})});default:return e.jsx("svg",{className:`${l} text-gray-500`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})})}};return e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:i,children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"파일 업로드"}),e.jsxs(B,{variant:"info",size:"sm",children:[t.length,"/",a]})]})}),e.jsxs(v,{children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${g?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:C,onDragLeave:f,onDrop:S,children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["파일을 드래그하여 놓거나"," ",e.jsx("button",{type:"button",className:"font-medium text-primary-600 hover:text-primary-500",onClick:()=>{var s;return(s=z.current)==null?void 0:s.click()},disabled:t.length>=a,children:"클릭하여 선택"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"이미지, PDF, 문서, 오디오, 비디오 파일 지원"})]}),e.jsx("input",{ref:z,type:"file",className:"hidden",multiple:!0,accept:"image/*,.pdf,.txt,.doc,.docx,.xls,.xlsx,.ppt,.pptx,audio/*,video/*",onChange:F,disabled:t.length>=a})]}),Object.keys(r).length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:Object.entries(r).map(([s,l])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"업로드 중..."}),e.jsxs("span",{children:[l,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]},s))}),t.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"업로드된 파일"}),e.jsx("div",{className:"space-y-3",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`cursor-pointer ${G(s.type)?"hover:opacity-80":""}`,onClick:()=>G(s.type)&&P(s),children:m(s)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate max-w-xs",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx("span",{children:fe(s.size)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.uploadedAt).toLocaleString()})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.type==="application/pdf"&&e.jsx(B,{variant:s.processed?"success":"warning",size:"sm",children:s.processed?"처리 완료":"처리 중"}),G(s.type)&&n&&e.jsx(M,{variant:"outline",size:"sm",onClick:()=>P(s),children:"미리보기"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>L(s.id),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},s.id))})]}),(j.isPending||k.isPending)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-blue-800",children:j.isPending?"파일 업로드 중...":"PDF 처리 중..."})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"💡 파일 업로드 가이드"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"이미지:"})," 자동으로 압축되어 업로드됩니다 (최대 5MB)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"PDF:"})," 자동으로 처리되어 AI가 내용을 참조할 수 있습니다 (최대 10MB)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"문서:"})," Word, Excel, PowerPoint 파일 지원 (최대 10MB)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"미디어:"})," 오디오(최대 20MB), 비디오(최대 50MB) 파일 지원"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"미리보기:"})," 이미지와 PDF 파일은 미리보기가 가능합니다"]})]})]})]})]}),d&&e.jsx(ve,{isOpen:!0,onClose:()=>_(null),title:d.name,size:"xl",children:e.jsx("div",{className:"max-h-96 overflow-auto",children:Y(d.type)?e.jsx("img",{src:d.url,alt:d.name,className:"max-w-full h-auto mx-auto"}):Z(d.type)?e.jsx("iframe",{src:d.url,className:"w-full h-96",title:d.name}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"미리보기를 지원하지 않는 파일 형식입니다."}),e.jsx(M,{className:"mt-4",onClick:()=>window.open(d.url,"_blank"),children:"파일 다운로드"})]})})})]})}function Se({activityId:x,className:y}){const[i,a]=u.useState({title:"",content:"",is_submitted:!1}),[n,t]=u.useState({title:"",content:""}),[h,g]=u.useState(!0),[b,d]=u.useState(!1),[_,r]=u.useState(!1),[w,z]=u.useState(!0),[o,j]=u.useState(null),{data:k}=T();u.useEffect(()=>{k&&x&&($(),c())},[k,x]),u.useEffect(()=>{if(!w||i.is_submitted)return;const m=setInterval(()=>{(n.title.trim()||n.content.trim())&&C()},3e4);return()=>clearInterval(m)},[n,w,i.is_submitted]);const $=async()=>{try{const{data:m,error:s}=await R.from("argumentation_responses").select("*").eq("student_id",k.id).eq("activity_id",x).single();if(s&&s.code!=="PGRST116")throw s;m&&(a(m),t({title:m.title||"",content:m.content||""}))}catch(m){console.error("Error loading argumentation data:",m)}finally{g(!1)}},c=async()=>{try{const{data:m,error:s}=await R.from("student_work_drafts").select("content, updated_at").eq("student_id",k.id).eq("activity_id",x).eq("draft_type","argumentation").single();if(s&&s.code!=="PGRST116")throw s;if(m&&m.content)try{const l=JSON.parse(m.content);(l.title||l.content)&&(t({title:l.title||"",content:l.content||"",last_saved:m.updated_at}),j(m.updated_at))}catch(l){console.error("Error parsing draft content:",l)}}catch(m){console.error("Error loading draft data:",m)}},C=async()=>{if(!(!k||b)){d(!0);try{const m=JSON.stringify({title:n.title,content:n.content}),{error:s}=await R.from("student_work_drafts").upsert({student_id:k.id,activity_id:x,draft_type:"argumentation",content:m});if(s)throw s;const l=new Date().toISOString();j(l),t(N=>({...N,last_saved:l}))}catch(m){console.error("Error saving draft:",m)}finally{d(!1)}}},f=async()=>{if(!k||!n.title.trim()||!n.content.trim()){alert("제목과 내용을 모두 입력해주세요.");return}if(window.confirm("논증문을 제출하시겠습니까? 제출 후에는 수정할 수 없습니다.")){r(!0);try{const m={student_id:k.id,activity_id:x,title:n.title,content:n.content,is_submitted:!0,submitted_at:new Date().toISOString()};if(i.id){const{error:s}=await R.from("argumentation_responses").update(m).eq("id",i.id);if(s)throw s}else{const{data:s,error:l}=await R.from("argumentation_responses").insert(m).select().single();if(l)throw l;a(s)}await R.from("student_work_drafts").delete().eq("student_id",k.id).eq("activity_id",x).eq("draft_type","argumentation"),alert("논증문이 성공적으로 제출되었습니다!"),await $()}catch(m){console.error("Error submitting argumentation:",m),alert("제출 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{r(!1)}}},S=m=>{const s=m.target.value;t(l=>({...l,title:s}))},F=m=>{const s=m.target.value;t(l=>({...l,content:s}))},L=m=>m.trim().split(/\s+/).filter(s=>s.length>0).length,P=m=>m.length;return h?e.jsx(p,{className:y,children:e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"논증 데이터를 불러오는 중..."})]})})}):e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"논증문 작성"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[i.is_submitted?e.jsx(B,{variant:"success",children:"제출 완료"}):e.jsx(B,{variant:"warning",children:"작성 중"}),o&&e.jsxs("span",{className:"text-xs text-gray-500",children:["마지막 저장: ",new Date(o).toLocaleString()]})]})]})}),e.jsx(v,{children:i.is_submitted?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i.title}),e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:["제출일: ",i.submitted_at?new Date(i.submitted_at).toLocaleString():"알 수 없음"]})]}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-gray-800 leading-relaxed",children:i.content})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["글자 수: ",P(i.content)," | 단어 수: ",L(i.content)]}),e.jsx(B,{variant:"success",children:"제출 완료"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{label:"논증문 제목",value:n.title,onChange:S,placeholder:"논증문의 제목을 입력하세요",disabled:_,maxLength:100}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"논증 내용"}),e.jsx("textarea",{value:n.content,onChange:F,rows:12,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100",placeholder:`논증 내용을 작성하세요...

다음 구조를 참고하세요:
1. 주장 (Claim): 당신의 입장을 명확히 제시
2. 근거 (Evidence): 주장을 뒷받침하는 사실, 데이터, 예시
3. 논증 (Warrant): 근거가 주장을 어떻게 지지하는지 설명
4. 반박 고려 (Counterargument): 반대 의견을 인정하고 대응
5. 결론 (Conclusion): 주장을 재확인하고 요약`,disabled:_,maxLength:5e3}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["글자 수: ",P(n.content),"/5000 | 단어 수: ",L(n.content)]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:m=>z(m.target.checked),className:"mr-1 h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),"자동 저장"]})})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200",children:[e.jsx(M,{variant:"outline",onClick:C,disabled:b||_,loading:b,children:"임시저장"}),e.jsx(M,{onClick:f,disabled:!n.title.trim()||!n.content.trim()||_,loading:_,children:"제출하기"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"💡 논증문 작성 가이드"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"명확한 주장:"})," 당신의 입장을 한 문장으로 명확히 표현하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"신뢰할 수 있는 근거:"})," 사실, 통계, 전문가 의견 등을 활용하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"논리적 연결:"})," 근거가 주장을 어떻게 지지하는지 설명하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"반박 고려:"})," 반대 의견을 인정하고 합리적으로 대응하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"명확한 결론:"})," 주장을 재확인하고 핵심 내용을 요약하세요"]})]})]})]})})]})}const J=[{id:"clarity",name:"명확성",description:"주장이 명확하고 이해하기 쉬운가?",maxScore:5},{id:"evidence",name:"근거의 적절성",description:"주장을 뒷받침하는 근거가 적절하고 충분한가?",maxScore:5},{id:"logic",name:"논리성",description:"논리적 흐름이 일관되고 타당한가?",maxScore:5},{id:"counterargument",name:"반박 고려",description:"반대 의견을 적절히 고려하고 대응했는가?",maxScore:5},{id:"overall",name:"전체적 완성도",description:"논증문의 전체적인 완성도는 어떤가?",maxScore:5}];function Me({activityId:x,className:y}){const[i,a]=u.useState([]),[n,t]=u.useState(null),[h,g]=u.useState({}),[b,d]=u.useState({}),[_,r]=u.useState(""),[w,z]=u.useState(!0),[o,j]=u.useState(!1),{data:k}=T();u.useEffect(()=>{k&&x&&$()},[k,x]);const $=async()=>{try{const{data:s,error:l}=await R.from("peer_evaluations").select(`
          *,
          target:students!peer_evaluations_target_id_fkey(name),
          target_response:argumentation_responses!peer_evaluations_target_id_fkey(title, content)
        `).eq("evaluator_id",k.id).eq("activity_id",x);if(l)throw l;const N=s.map(I=>{var H,U,V;return{id:I.id,evaluator_id:I.evaluator_id,target_id:I.target_id,target_name:((H=I.target)==null?void 0:H.name)||"알 수 없음",target_title:((U=I.target_response)==null?void 0:U.title)||"제목 없음",target_content:((V=I.target_response)==null?void 0:V.content)||"내용 없음",evaluation_data:I.evaluation_data,is_completed:I.is_completed,completed_at:I.completed_at}});a(N);const W=N.find(I=>!I.is_completed);W&&(t(W),c(W))}catch(s){console.error("Error loading evaluation targets:",s)}finally{z(!1)}},c=s=>{s.evaluation_data?(g(s.evaluation_data.scores||{}),d(s.evaluation_data.comments||{}),r(s.evaluation_data.overallComment||"")):(g({}),d({}),r(""))},C=s=>{t(s),c(s)},f=(s,l)=>{g(N=>({...N,[s]:l}))},S=(s,l)=>{d(N=>({...N,[s]:l}))},F=async()=>{if(!n||!k)return;const s=J.filter(l=>!h[l.id]);if(s.length>0){alert(`다음 항목의 점수를 입력해주세요: ${s.map(l=>l.name).join(", ")}`);return}if(!_.trim()){alert("전체적인 피드백을 입력해주세요.");return}if(window.confirm("평가를 제출하시겠습니까? 제출 후에는 수정할 수 없습니다.")){j(!0);try{const l={scores:h,comments:b,overallComment:_,submittedAt:new Date().toISOString()},{error:N}=await R.from("peer_evaluations").update({evaluation_data:l,is_completed:!0,completed_at:new Date().toISOString()}).eq("id",n.id);if(N)throw N;alert("평가가 성공적으로 제출되었습니다!"),await $();const W=i.find(I=>I.id!==n.id&&!I.is_completed);W?(t(W),c(W)):t(null)}catch(l){console.error("Error submitting evaluation:",l),alert("평가 제출 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{j(!1)}}},L=()=>Object.values(h).reduce((s,l)=>s+l,0),P=()=>J.reduce((s,l)=>s+l.maxScore,0),m=()=>i.filter(s=>s.is_completed).length;return w?e.jsx(p,{className:y,children:e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"동료평가 데이터를 불러오는 중..."})]})})}):i.length===0?e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsx(A,{children:"동료평가"})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-gray-500",children:"아직 배정된 동료평가가 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"논증문 제출 후 관리자가 동료평가를 배정하면 여기에 표시됩니다."})]})})]}):e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"동료평가"}),e.jsxs(B,{variant:"info",children:[m(),"/",i.length," 완료"]})]})}),e.jsxs(v,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"평가 대상"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.map(s=>e.jsxs("button",{onClick:()=>C(s),className:`p-3 border rounded-lg text-left transition-colors ${(n==null?void 0:n.id)===s.id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,disabled:s.is_completed,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.target_name}),e.jsx(B,{variant:s.is_completed?"success":"warning",size:"sm",children:s.is_completed?"완료":"대기"})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:s.target_title})]},s.id))})]}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:[n.target_name,"의 논증문"]}),e.jsx("h5",{className:"text-lg font-semibold text-gray-800 mb-3",children:n.target_title}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-gray-700 text-sm leading-relaxed max-h-64 overflow-y-auto",children:n.target_content})})]}),n.is_completed?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"제출된 평가"}),e.jsx(B,{variant:"success",children:"평가 완료"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:J.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-lg font-bold text-primary-600",children:[h[s.id]||0,"/",s.maxScore]})]}),b[s.id]&&e.jsx("p",{className:"text-sm text-gray-600",children:b[s.id]})]},s.id))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"전체 피드백"}),e.jsx("p",{className:"text-blue-800",children:_})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["총점: ",L(),"/",P()]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["완료일: ",n.completed_at?new Date(n.completed_at).toLocaleString():"알 수 없음"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"평가 작성"}),e.jsx("div",{className:"space-y-4",children:J.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-primary-600",children:[h[s.id]||0,"/",s.maxScore]})})]}),e.jsx("div",{className:"flex space-x-2 mb-3",children:Array.from({length:s.maxScore},(l,N)=>N+1).map(l=>e.jsx("button",{onClick:()=>f(s.id,l),className:`w-8 h-8 rounded-full border-2 text-sm font-medium transition-colors ${h[s.id]===l?"border-primary-500 bg-primary-500 text-white":"border-gray-300 text-gray-600 hover:border-primary-300"}`,children:l},l))}),e.jsx("textarea",{value:b[s.id]||"",onChange:l=>S(s.id,l.target.value),placeholder:"이 항목에 대한 구체적인 피드백을 작성해주세요 (선택사항)",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm"})]},s.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전체적인 피드백 *"}),e.jsx("textarea",{value:_,onChange:s=>r(s.target.value),placeholder:"논증문에 대한 전체적인 피드백을 작성해주세요. 좋은 점과 개선할 점을 균형있게 제시해주세요.",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:e.jsxs("div",{className:"text-xl font-bold text-gray-900",children:["현재 총점: ",L(),"/",P()]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(M,{onClick:F,disabled:L()===0||!_.trim()||o,loading:o,children:"평가 제출"})})]})]}),e.jsxs("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"💡 동료평가 가이드"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"공정하고 객관적으로:"})," 개인적 감정이 아닌 논증의 질을 평가하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"건설적인 피드백:"})," 비판보다는 개선 방향을 제시하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"구체적인 근거:"})," 점수에 대한 구체적인 이유를 설명하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"균형잡힌 평가:"})," 좋은 점과 개선할 점을 모두 언급하세요"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"존중하는 태도:"})," 상대방을 존중하는 언어를 사용하세요"]})]})]})]})]})}function Te(){const{activityId:x}=he(),y=le(),{user:i}=xe();ye({studentId:i==null?void 0:i.id,activityId:x});const{data:a,isLoading:n,error:t}=be(x||""),h=d=>{switch(d){case"argumentation":return"논증 활동";case"discussion":return"토론 활동";case"experiment":return"실험 활동";default:return d}},g=d=>{switch(d){case"argumentation":return"info";case"discussion":return"warning";case"experiment":return"success";default:return"default"}};if(n)return e.jsx(O,{title:"활동 로딩 중...",showSidebar:!1,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});if(t||!a)return e.jsx(O,{title:"활동을 찾을 수 없습니다",showSidebar:!1,children:e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"요청하신 활동을 찾을 수 없습니다."}),e.jsx(M,{onClick:()=>y("/student"),children:"대시보드로 돌아가기"})]})})})});const b=e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(M,{variant:"outline",onClick:()=>y("/student"),children:"대시보드로"}),e.jsx(M,{children:"활동 완료"})]});return e.jsxs(O,{title:a.title,subtitle:h(a.type),headerActions:b,showSidebar:!1,children:[e.jsxs(p,{className:"mb-6",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"활동 정보"}),e.jsx(B,{variant:g(a.type),children:h(a.type)})]})}),e.jsx(v,{children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:a.description})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(Ce,{activityId:a.id}),e.jsx("div",{className:"mt-6",children:e.jsx(_e,{onFileProcessed:d=>{console.log("File processed:",d)},maxFiles:5,showPreview:!0})})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"AI 학습 도우미"})}),e.jsx(v,{children:e.jsx("div",{className:"p-0",children:e.jsx(me,{activityId:a.id})})})]})})]}),a.type==="argumentation"&&e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsx(Se,{activityId:a.id}),e.jsx(Me,{activityId:a.id})]}),a.type==="discussion"&&e.jsxs(p,{className:"mt-6",children:[e.jsx(D,{children:e.jsx(A,{children:"토론 참여"})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"토론 기능은 개발 중입니다."}),e.jsx("p",{className:"text-sm text-gray-400",children:"곧 실시간 토론 기능을 제공할 예정입니다."})]})})]}),a.type==="experiment"&&e.jsxs(p,{className:"mt-6",children:[e.jsx(D,{children:e.jsx(A,{children:"실험 기록"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"실험 가설"}),e.jsx("textarea",{rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"실험 가설을 작성하세요..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"실험 과정 및 관찰 내용"}),e.jsx("textarea",{rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"실험 과정과 관찰한 내용을 자세히 기록하세요..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"실험 결과 및 결론"}),e.jsx("textarea",{rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"실험 결과와 결론을 작성하세요..."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(M,{variant:"outline",children:"임시저장"}),e.jsx(M,{children:"실험 보고서 제출"})]})]})})]})]})}function Le({onFileProcessed:x,className:y}){const[i,a]=u.useState([]),[n,t]=u.useState(!1),h=u.useRef(null),{data:g}=T(),b=de(),d=oe(),_=c=>{!c||!g||Array.from(c).forEach(async C=>{if(C.size>10*1024*1024){alert(`${C.name}은(는) 파일 크기가 너무 큽니다. (최대 10MB)`);return}if(!["application/pdf","text/plain","image/jpeg","image/png","image/gif","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(C.type)){alert(`${C.name}은(는) 지원되지 않는 파일 형식입니다.`);return}try{const S=await b.mutateAsync({file:C,studentId:g.id}),F={id:`file-${Date.now()}-${Math.random()}`,name:S.fileName,size:S.fileSize,type:S.fileType,url:S.url,uploadedAt:new Date().toISOString(),processed:!1};if(a(L=>[...L,F]),C.type==="application/pdf")try{await d.mutateAsync({fileUrl:S.url,fileName:S.fileName}),a(L=>L.map(P=>P.id===F.id?{...P,processed:!0}:P)),x==null||x(S.fileName)}catch(L){console.error("PDF processing error:",L),alert("PDF 처리 중 오류가 발생했습니다.")}}catch(S){console.error("File upload error:",S),alert("파일 업로드 중 오류가 발생했습니다.")}})},r=c=>{c.preventDefault(),t(!0)},w=c=>{c.preventDefault(),t(!1)},z=c=>{c.preventDefault(),t(!1),_(c.dataTransfer.files)},o=c=>{_(c.target.files),c.target.value=""},j=c=>{if(c===0)return"0 Bytes";const C=1024,f=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(c)/Math.log(C));return parseFloat((c/Math.pow(C,S)).toFixed(2))+" "+f[S]},k=c=>c.includes("pdf")?e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}):c.includes("image")?e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),$=c=>{a(C=>C.filter(f=>f.id!==c))};return e.jsxs(p,{className:y,children:[e.jsx(D,{children:e.jsx(A,{children:"파일 업로드"})}),e.jsxs(v,{children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${n?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:r,onDragLeave:w,onDrop:z,children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["파일을 드래그하여 놓거나"," ",e.jsx("button",{type:"button",className:"font-medium text-primary-600 hover:text-primary-500",onClick:()=>{var c;return(c=h.current)==null?void 0:c.click()},children:"클릭하여 선택"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, 이미지, 텍스트 파일 지원 (최대 10MB)"})]}),e.jsx("input",{ref:h,type:"file",className:"hidden",multiple:!0,accept:".pdf,.txt,.jpg,.jpeg,.png,.gif,.doc,.docx",onChange:o})]}),i.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"업로드된 파일"}),e.jsx("div",{className:"space-y-3",children:i.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[k(c.type),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[j(c.size)," • ",new Date(c.uploadedAt).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c.type==="application/pdf"&&e.jsx(B,{variant:c.processed?"success":"warning",size:"sm",children:c.processed?"처리 완료":"처리 중"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>$(c.id),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]},c.id))})]}),(b.isPending||d.isPending)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),e.jsx("span",{className:"text-sm text-blue-800",children:b.isPending?"파일 업로드 중...":"PDF 처리 중..."})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"💡 파일 업로드 팁"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• PDF 파일은 자동으로 처리되어 AI가 내용을 참조할 수 있습니다"}),e.jsx("li",{children:"• 이미지 파일은 시각적 참고 자료로 활용됩니다"}),e.jsx("li",{children:"• 텍스트 파일은 추가 학습 자료로 사용됩니다"}),e.jsx("li",{children:'• 처리된 파일은 채팅에서 "문서 검색" 옵션을 켜면 활용됩니다'})]})]})]})]})}const Ie=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),De=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"})}),Ae=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),ze=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});function Ve(){const[x,y]=u.useState(null),[i,a]=u.useState(!1),{data:n}=ce(),t=[{label:"대시보드",href:"/student",icon:e.jsx(De,{})},{label:"AI 채팅",href:"/student/chat",icon:e.jsx(Ie,{})},{label:"내 프로필",href:"/student/profile",icon:e.jsx(Ae,{})},{label:"활동 기록",href:"/student/history",icon:e.jsx(ze,{})}],h=n==null?void 0:n.find(d=>d.id===x),g=d=>{switch(d){case"argumentation":return"논증 활동";case"discussion":return"토론 활동";case"experiment":return"실험 활동";default:return d}},b=e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>a(!i),children:i?"파일 업로드 숨기기":"파일 업로드"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>y(null),disabled:!x,children:"일반 채팅"})]});return e.jsxs(O,{title:"AI 채팅",subtitle:h?`${h.title} - ${g(h.type)}`:"일반 학습 채팅",headerActions:b,sidebarItems:t,showSidebar:!0,children:[n&&n.length>0&&e.jsxs(p,{className:"mb-6",children:[e.jsx(D,{children:e.jsx(A,{children:"활동 선택"})}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(M,{variant:x===null?"primary":"outline",size:"sm",onClick:()=>y(null),children:"일반 채팅"}),n.map(d=>e.jsx(M,{variant:x===d.id?"primary":"outline",size:"sm",onClick:()=>y(d.id),children:d.title},d.id))]}),h&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:h.title}),"에 대한 맞춤형 AI 도움을 받을 수 있습니다."]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:h.description})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[i&&e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Le,{onFileProcessed:d=>{console.log("File processed:",d)}})}),e.jsx("div",{className:i?"lg:col-span-3":"lg:col-span-4",children:e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:h?`${h.title} AI 도우미`:"AI 학습 도우미"})}),e.jsx(v,{padding:"none",children:e.jsx("div",{className:"h-[600px]",children:e.jsx(me,{activityId:x||void 0,className:"h-full"})})})]})})]}),e.jsxs(p,{className:"mt-6",children:[e.jsx(D,{children:e.jsx(A,{children:"💡 효과적인 AI 채팅 가이드"})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"좋은 질문 예시"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:'• "기후변화의 주요 원인 3가지를 설명해주세요"'}),e.jsx("li",{children:'• "이 실험에서 변인을 어떻게 통제해야 할까요?"'}),e.jsx("li",{children:'• "논증에서 반박 의견을 어떻게 다뤄야 하나요?"'}),e.jsx("li",{children:'• "토론에서 상대방 의견을 존중하는 방법은?"'})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"유용한 기능"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 문서 검색: 업로드한 파일 내용을 참조한 답변"}),e.jsx("li",{children:"• 활동별 맞춤 도움: 각 활동에 특화된 AI 지원"}),e.jsx("li",{children:"• 대화 기록: 이전 대화 내용을 기억하는 연속 대화"}),e.jsx("li",{children:"• 파일 업로드: PDF, 이미지 등 참고 자료 활용"})]})]})]})})]})]})}const te=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Be=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"})}),$e=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),Ee=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});function Oe(){const[x,y]=u.useState(!1),[i,a]=u.useState({name:"",class_name:""}),{user:n}=xe(),{data:t,isLoading:h}=T(),{data:g}=Q((t==null?void 0:t.id)||""),b=Ne(),d=[{label:"대시보드",href:"/student",icon:e.jsx(Be,{})},{label:"AI 채팅",href:"/student/chat",icon:e.jsx($e,{})},{label:"내 프로필",href:"/student/profile",icon:e.jsx(te,{})},{label:"활동 기록",href:"/student/history",icon:e.jsx(Ee,{})}];React.useEffect(()=>{t&&a({name:t.name||"",class_name:t.class_name||""})},[t]);const _=()=>{y(!0)},r=()=>{y(!1),t&&a({name:t.name||"",class_name:t.class_name||""})},w=async()=>{if(t)try{await b.mutateAsync({id:t.id,...i}),y(!1),alert("프로필이 성공적으로 업데이트되었습니다!")}catch(j){console.error("Error updating profile:",j),alert("프로필 업데이트 중 오류가 발생했습니다.")}},o=(()=>{if(!g)return{total:0,thisWeek:0,thisMonth:0};const j=new Date,k=new Date(j.getTime()-10080*60*1e3),$=new Date(j.getTime()-720*60*60*1e3);return{total:g.length,thisWeek:g.filter(c=>new Date(c.created_at)>=k).length,thisMonth:g.filter(c=>new Date(c.created_at)>=$).length}})();return h?e.jsx(O,{title:"내 프로필",subtitle:"프로필 정보를 확인하고 수정할 수 있습니다",sidebarItems:d,showSidebar:!0,children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):e.jsxs(O,{title:"내 프로필",subtitle:"프로필 정보를 확인하고 수정할 수 있습니다",sidebarItems:d,showSidebar:!0,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(p,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"기본 정보"}),x?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(M,{variant:"outline",onClick:r,children:"취소"}),e.jsx(M,{onClick:w,loading:b.isPending,children:"저장"})]}):e.jsx(M,{variant:"outline",onClick:_,children:"수정"})]})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(te,{})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:(t==null?void 0:t.name)||"이름 없음"}),e.jsx("p",{className:"text-gray-600",children:"학생"}),e.jsx(B,{variant:"success",size:"sm",children:"활성"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(K,{label:"이름",value:i.name,onChange:j=>a({...i,name:j.target.value}),disabled:!x}),e.jsx(K,{label:"학번",value:(t==null?void 0:t.student_id)||"",disabled:!0,helperText:"학번은 변경할 수 없습니다"}),e.jsx(K,{label:"반",value:i.class_name,onChange:j=>a({...i,class_name:j.target.value}),disabled:!x,placeholder:"예: 1학년 1반"}),e.jsx(K,{label:"이메일",value:(n==null?void 0:n.email)||"",disabled:!0,helperText:"이메일은 변경할 수 없습니다"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"계정 정보"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"가입일:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t!=null&&t.created_at?new Date(t.created_at).toLocaleDateString():"알 수 없음"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"마지막 업데이트:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:t!=null&&t.updated_at?new Date(t.updated_at).toLocaleDateString():"알 수 없음"})]})]})]})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"AI 채팅 통계"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:o.total}),e.jsx("div",{className:"text-sm text-gray-500",children:"총 채팅 수"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:o.thisWeek}),e.jsx("div",{className:"text-xs text-gray-500",children:"이번 주"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:o.thisMonth}),e.jsx("div",{className:"text-xs text-gray-500",children:"이번 달"})]})]})]})})]}),e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"학습 현황"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"완료한 활동"}),e.jsx(B,{variant:"info",children:"0개"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"진행 중인 활동"}),e.jsx(B,{variant:"warning",children:"0개"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"동료평가 완료"}),e.jsx(B,{variant:"success",children:"0개"})]})]})})]}),e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"최근 활동"})}),e.jsx(v,{children:g&&g.length>0?e.jsx("div",{className:"space-y-3",children:g.slice(-3).map(j=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"AI 채팅"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(j.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-600 text-xs truncate",children:j.message})]},j.id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"최근 활동이 없습니다."})})})]})]})]}),e.jsxs(p,{className:"mt-6",children:[e.jsx(D,{children:e.jsx(A,{children:"💡 효과적인 학습을 위한 팁"})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"AI 채팅 활용"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 구체적이고 명확한 질문하기"}),e.jsx("li",{children:"• 단계별로 나누어 질문하기"}),e.jsx("li",{children:"• 이해가 안 되면 다시 물어보기"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"논증 작성"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 명확한 주장 제시하기"}),e.jsx("li",{children:"• 신뢰할 수 있는 근거 사용하기"}),e.jsx("li",{children:"• 반대 의견도 고려하기"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"동료평가"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 객관적이고 공정하게 평가하기"}),e.jsx("li",{children:"• 건설적인 피드백 제공하기"}),e.jsx("li",{children:"• 상대방을 존중하는 태도 유지하기"})]})]})]})})]})]})}const re=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),ae=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"})}),ne=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),ie=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Pe=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})});function Ue(){const[x,y]=u.useState("chat"),[i,a]=u.useState("all"),{data:n}=T(),{data:t}=Q((n==null?void 0:n.id)||""),h=[{label:"대시보드",href:"/student",icon:e.jsx(ae,{})},{label:"AI 채팅",href:"/student/chat",icon:e.jsx(ne,{})},{label:"내 프로필",href:"/student/profile",icon:e.jsx(ie,{})},{label:"활동 기록",href:"/student/history",icon:e.jsx(re,{})}],b=(()=>{if(!t)return[];if(i==="all")return t;const r=new Date,w=i==="week"?new Date(r.getTime()-10080*60*1e3):new Date(r.getTime()-720*60*60*1e3);return t.filter(z=>new Date(z.created_at)>=w)})(),d=r=>{switch(r){case"all":return"전체";case"week":return"최근 1주일";case"month":return"최근 1개월";default:return r}},_=e.jsx("div",{className:"flex space-x-2",children:e.jsx(M,{variant:"outline",size:"sm",children:"내보내기"})});return e.jsxs(O,{title:"활동 기록",subtitle:"나의 학습 활동 기록을 확인할 수 있습니다",headerActions:_,sidebarItems:h,showSidebar:!0,children:[e.jsx(p,{className:"mb-6",children:e.jsx(v,{padding:"none",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:[{key:"chat",label:"AI 채팅 기록",count:(t==null?void 0:t.length)||0},{key:"activities",label:"활동 기록",count:0},{key:"evaluations",label:"동료평가 기록",count:0}].map(r=>e.jsxs("button",{onClick:()=>y(r.key),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${x===r.key?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{children:r.label}),e.jsx(B,{variant:"info",size:"sm",children:r.count})]},r.key))})})})}),e.jsx(p,{className:"mb-6",children:e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"기간 필터"}),e.jsx("div",{className:"flex space-x-2",children:["all","week","month"].map(r=>e.jsx(M,{variant:i===r?"primary":"outline",size:"sm",onClick:()=>a(r),children:d(r)},r))})]})})}),x==="chat"&&e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"AI 채팅 기록"})}),e.jsx(v,{children:b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(r.created_at).toLocaleString()})]}),e.jsx(B,{variant:"info",size:"sm",children:"AI 채팅"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ie,{}),e.jsx("span",{className:"ml-2 text-sm font-medium text-blue-900",children:"내 질문"})]}),e.jsx("p",{className:"text-blue-800 text-sm",children:r.message})]}),e.jsxs("div",{className:"bg-gray-50 border-l-4 border-gray-400 p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900",children:"AI 응답"})]}),e.jsx("p",{className:"text-gray-800 text-sm whitespace-pre-wrap",children:r.response})]})]})]},r.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ne,{}),e.jsx("p",{className:"text-gray-500 mt-4",children:i==="all"?"아직 AI 채팅 기록이 없습니다.":`${d(i)} 동안의 채팅 기록이 없습니다.`}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"AI와 대화를 시작해보세요!"})]})})]}),x==="activities"&&e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"활동 기록"})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{}),e.jsx("p",{className:"text-gray-500 mt-4",children:"아직 완료한 활동이 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"활동을 완료하면 여기에 기록이 표시됩니다."})]})})]}),x==="evaluations"&&e.jsxs(p,{children:[e.jsx(D,{children:e.jsx(A,{children:"동료평가 기록"})}),e.jsx(v,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{}),e.jsx("p",{className:"text-gray-500 mt-4",children:"아직 완료한 동료평가가 없습니다."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"동료평가를 완료하면 여기에 기록이 표시됩니다."})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-6",children:[e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:b.length}),e.jsxs("div",{className:"text-sm text-gray-600",children:[d(i)," 채팅 수"]})]})})}),e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"완료한 활동"})]})})}),e.jsx(p,{children:e.jsx(v,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"동료평가 완료"})]})})})]})]})}export{He as S,Te as a,Ve as b,Oe as c,Ue as d};
