import{j as e,u as H,a as J,b as K}from"./query-BJLVRUEZ.js";import{r as p,N as be}from"./router-BVXzBWz1.js";import{c as Ne}from"./supabase-DOO4-DDb.js";const we="http://localhost:54321",ke="your-anon-key",v=Ne(we,ke,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}}),ge=p.createContext(void 0);function us({children:s}){const[t,r]=p.useState(null),[n,a]=p.useState(null),[u,o]=p.useState(!0);p.useEffect(()=>{v.auth.getSession().then(({data:{session:c}})=>{a(c),r((c==null?void 0:c.user)??null),o(!1)});const{data:{subscription:i}}=v.auth.onAuthStateChange((c,h)=>{a(h),r((h==null?void 0:h.user)??null),o(!1)});return()=>i.unsubscribe()},[]);const d={user:t,session:n,loading:u,signOut:async()=>{await v.auth.signOut()}};return e.jsx(ge.Provider,{value:d,children:s})}function _e(){const s=p.useContext(ge);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}function B(...s){return s.filter(Boolean).join(" ")}const N=p.forwardRef(({className:s,variant:t="primary",size:r="md",loading:n,children:a,disabled:u,...o},m)=>{const d="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i={primary:"bg-primary-600 text-white hover:bg-primary-700 focus-visible:ring-primary-500",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 focus-visible:ring-gray-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus-visible:ring-gray-500",ghost:"text-gray-700 hover:bg-gray-100 focus-visible:ring-gray-500",destructive:"bg-red-600 text-white hover:bg-red-700 focus-visible:ring-red-500"},c={sm:"h-8 px-3 text-sm",md:"h-10 px-4 text-sm",lg:"h-12 px-6 text-base"};return e.jsxs("button",{className:B(d,i[t],c[r],s),ref:m,disabled:u||n,...o,children:[n&&e.jsxs("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a]})});N.displayName="Button";function Se({title:s,subtitle:t,actions:r}){const{user:n,signOut:a}=_e();return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-500",children:t})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[r,e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:n==null?void 0:n.email}),e.jsx(N,{variant:"outline",size:"sm",onClick:a,children:"로그아웃"})]})]})]})})})}function Ce({items:s,className:t}){return e.jsx("aside",{className:B("w-64 bg-white border-r border-gray-200",t),children:e.jsx("nav",{className:"p-4 space-y-2",children:s.map(r=>e.jsxs(be,{to:r.href,className:({isActive:n})=>B("flex items-center justify-between px-3 py-2 rounded-md text-sm font-medium transition-colors",n?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r.icon,e.jsx("span",{children:r.label})]}),r.badge&&e.jsx("span",{className:"bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-full",children:r.badge})]},r.href))})})}function X({children:s,title:t,subtitle:r,headerActions:n,sidebarItems:a=[],showSidebar:u=!1}){return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Se,{title:t,subtitle:r,actions:n}),e.jsxs("div",{className:"flex",children:[u&&a.length>0&&e.jsx(Ce,{items:a}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:s})})]})]})}function C({children:s,className:t,padding:r="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:B("bg-white rounded-lg border border-gray-200 shadow-sm",n[r],t),children:s})}function I({children:s,className:t}){return e.jsx("div",{className:B("border-b border-gray-200 pb-4 mb-4",t),children:s})}function E({children:s,className:t}){return e.jsx("h3",{className:B("text-lg font-semibold text-gray-900",t),children:s})}function L({children:s,className:t}){return e.jsx("div",{className:B("text-gray-600",t),children:s})}function D({children:s,variant:t="default",size:r="md",className:n}){const a={default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",warning:"bg-yellow-100 text-yellow-800",error:"bg-red-100 text-red-800",info:"bg-blue-100 text-blue-800"},u={sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm"};return e.jsx("span",{className:B("inline-flex items-center rounded-full font-medium",a[t],u[r],n),children:s})}function ne(){return H({queryKey:["students"],queryFn:async()=>{const{data:s,error:t}=await v.from("students").select(`
          *,
          user_roles!inner(role),
          student_sessions(is_active, last_activity)
        `).order("created_at",{ascending:!1});if(t)throw t;return s}})}function xs(){return H({queryKey:["current-student"],queryFn:async()=>{const{data:{user:s}}=await v.auth.getUser();if(!s)throw new Error("Not authenticated");const{data:t,error:r}=await v.from("students").select("*").eq("user_id",s.id).single();if(r)throw r;return t}})}function Le(){const s=J();return K({mutationFn:async t=>{const{data:r,error:n}=await v.from("students").insert(t).select().single();if(n)throw n;return r},onSuccess:()=>{s.invalidateQueries({queryKey:["students"]})}})}function ze(){const s=J();return K({mutationFn:async({id:t,...r})=>{const{data:n,error:a}=await v.from("students").update(r).eq("id",t).select().single();if(a)throw a;return n},onSuccess:()=>{s.invalidateQueries({queryKey:["students"]}),s.invalidateQueries({queryKey:["current-student"]})}})}function Me(){const s=J();return K({mutationFn:async t=>{const{error:r}=await v.from("students").delete().eq("id",t);if(r)throw r},onSuccess:()=>{s.invalidateQueries({queryKey:["students"]})}})}function je(){return H({queryKey:["activities"],queryFn:async()=>{const{data:s,error:t}=await v.from("activities").select(`
          *,
          checklist_items(*)
        `).order("created_at",{ascending:!1});if(t)throw t;return s}})}function hs(){return H({queryKey:["activities","active"],queryFn:async()=>{const{data:s,error:t}=await v.from("activities").select(`
          *,
          checklist_items(*)
        `).eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;return s}})}function ps(s){return H({queryKey:["activities",s],queryFn:async()=>{const{data:t,error:r}=await v.from("activities").select(`
          *,
          checklist_items(*),
          activity_modules(*)
        `).eq("id",s).single();if(r)throw r;return t},enabled:!!s})}function Ae(){const s=J();return K({mutationFn:async t=>{const{data:r,error:n}=await v.from("activities").insert(t).select().single();if(n)throw n;return r},onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]})}})}function Ie(){const s=J();return K({mutationFn:async({id:t,...r})=>{const{data:n,error:a}=await v.from("activities").update(r).eq("id",t).select().single();if(a)throw a;return n},onSuccess:t=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["activities",t.id]})}})}function Ee(){const s=J();return K({mutationFn:async t=>{const{error:r}=await v.from("activities").delete().eq("id",t);if(r)throw r},onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]})}})}function gs(s){return H({queryKey:["checklist-items",s],queryFn:async()=>{const{data:t,error:r}=await v.from("checklist_items").select("*").eq("activity_id",s).order("order_index");if(r)throw r;return t},enabled:!!s})}function js(s,t){return H({queryKey:["chat-history",s,t],queryFn:async()=>{let r=v.from("chat_logs").select("*").eq("student_id",s).order("created_at",{ascending:!0});t&&(r=r.eq("activity_id",t));const{data:n,error:a}=await r;if(a)throw a;return n},enabled:!!s})}function fe(s="day"){return H({queryKey:["chat-statistics",s],queryFn:async()=>{const t=new Date;let r;switch(s){case"day":r=new Date(t.getTime()-1440*60*1e3);break;case"week":r=new Date(t.getTime()-10080*60*1e3);break;case"month":r=new Date(t.getTime()-720*60*60*1e3);break}const{data:n,error:a}=await v.from("chat_logs").select(`
          id,
          student_id,
          tokens_used,
          model_used,
          created_at,
          students(name)
        `).gte("created_at",r.toISOString());if(a)throw a;const u=n.length,o=n.reduce((c,h)=>c+(h.tokens_used||0),0),m=new Set(n.map(c=>c.student_id)).size,d=n.reduce((c,h)=>{const w=h.model_used||"unknown";return c[w]=(c[w]||0)+1,c},{}),i=n.reduce((c,h)=>{const w=new Date(h.created_at).toISOString().split("T")[0];return c[w]=(c[w]||0)+1,c},{});return{totalMessages:u,totalTokens:o,uniqueStudents:m,modelUsage:d,dailyActivity:i,averageTokensPerMessage:u>0?Math.round(o/u):0}}})}function qe(s){return H({queryKey:["question-frequency",s],queryFn:async()=>{let t=v.from("question_frequency").select(`
          *,
          students(name)
        `).order("frequency_count",{ascending:!1}).limit(20);const{data:r,error:n}=await t;if(n)throw n;return r}})}function fs(){return K({mutationFn:async({file:s,studentId:t})=>{const r=s.name.split(".").pop(),n=`${t}/${Date.now()}.${r}`,{data:a,error:u}=await v.storage.from("chat-files").upload(n,s);if(u)throw u;const{data:o}=v.storage.from("chat-files").getPublicUrl(n);return{path:a.path,url:o.publicUrl,fileName:s.name,fileSize:s.size,fileType:s.type}}})}function ys(){return K({mutationFn:async({fileUrl:s,fileName:t})=>{const{data:r,error:n}=await v.functions.invoke("process-pdf",{body:{fileUrl:s,fileName:t}});if(n)throw n;return r}})}function ie({table:s,filter:t,event:r="*",onInsert:n,onUpdate:a,onDelete:u,onChange:o}){const[m,d]=p.useState(!1),[i,c]=p.useState(null),h=p.useRef(null);return p.useEffect(()=>{const l=`realtime-${s}-${Date.now()}`,z=v.channel(l).on("postgres_changes",{event:r,schema:"public",table:s,filter:t},b=>{switch(console.log("Realtime payload:",b),b.eventType){case"INSERT":n==null||n(b);break;case"UPDATE":a==null||a(b);break;case"DELETE":u==null||u(b);break}o==null||o(b)}).subscribe(b=>{console.log("Realtime subscription status:",b),b==="SUBSCRIBED"?(d(!0),c(null)):b==="CHANNEL_ERROR"?(d(!1),c("실시간 연결 오류가 발생했습니다.")):b==="TIMED_OUT"?(d(!1),c("실시간 연결 시간이 초과되었습니다.")):b==="CLOSED"&&d(!1)});return h.current=z,()=>{h.current&&(v.removeChannel(h.current),h.current=null),d(!1)}},[s,t,r,n,a,u,o]),{isConnected:m,error:i,reconnect:()=>{h.current&&h.current.subscribe()}}}function Fe(){const[s,t]=p.useState([]),{isConnected:r,error:n}=ie({table:"student_sessions",event:"*",onChange:a=>{t(u=>[...u.slice(-9),a])}});return{sessionUpdates:s,isConnected:r,error:n}}function Te(){const[s,t]=p.useState([]),{isConnected:r,error:n}=ie({table:"argumentation_responses",filter:"is_submitted=eq.true",event:"UPDATE",onUpdate:u=>{var o,m;(o=u.new)!=null&&o.is_submitted&&!((m=u.old)!=null&&m.is_submitted)&&t(d=>[...d.slice(-9),u.new])}});return{submissions:s,clearSubmissions:()=>{t([])},isConnected:r,error:n}}function De(){const[s,t]=p.useState([]),{isConnected:r,error:n}=ie({table:"peer_evaluations",filter:"is_completed=eq.true",event:"UPDATE",onUpdate:u=>{var o,m;(o=u.new)!=null&&o.is_completed&&!((m=u.old)!=null&&m.is_completed)&&t(d=>[...d.slice(-9),u.new])}});return{evaluations:s,clearEvaluations:()=>{t([])},isConnected:r,error:n}}function ye(){const[s,t]=p.useState([]),r=i=>{const c=`notification-${Date.now()}-${Math.random()}`,h={...i,id:c};return t(w=>[...w,h]),c};return{notifications:s,addNotification:r,removeNotification:i=>{t(c=>c.filter(h=>h.id!==i))},clearAllNotifications:()=>{t([])},showSuccess:(i,c,h)=>r({type:"success",title:i,message:c,action:h}),showError:(i,c,h)=>r({type:"error",title:i,message:c,action:h,duration:8e3}),showWarning:(i,c,h)=>r({type:"warning",title:i,message:c,action:h,duration:6e3}),showInfo:(i,c,h)=>r({type:"info",title:i,message:c,action:h})}}function $e(){const[s,t]=p.useState([]),[r,n]=p.useState([]),[a,u]=p.useState([]),[o,m]=p.useState(!1),{showInfo:d,showSuccess:i}=ye(),{sessionUpdates:c,isConnected:h}=Fe(),{submissions:w,clearSubmissions:l}=Te(),{evaluations:z,clearEvaluations:b}=De(),A=async()=>{try{const{data:x,error:_}=await v.from("student_sessions").select(`
          student_id,
          last_activity,
          students (
            id,
            name,
            class_name
          )
        `).eq("is_active",!0).gte("last_activity",new Date(Date.now()-18e5).toISOString()).order("last_activity",{ascending:!1});if(_)throw _;const S=(x==null?void 0:x.map(M=>({id:M.students.id,name:M.students.name,class_name:M.students.class_name,last_activity:M.last_activity})))||[];t(S)}catch(x){console.error("Error fetching online students:",x)}},g=async()=>{try{const{data:x,error:_}=await v.from("chat_logs").select(`
          id,
          message,
          created_at,
          students (
            name
          ),
          activities (
            title
          )
        `).order("created_at",{ascending:!1}).limit(10);if(_)throw _;const S=(x==null?void 0:x.map(M=>{var j,$;return{id:M.id,student_name:((j=M.students)==null?void 0:j.name)||"알 수 없음",message:M.message,created_at:M.created_at,activity_title:($=M.activities)==null?void 0:$.title}}))||[];n(S)}catch(x){console.error("Error fetching recent messages:",x)}},q=x=>{const _=new Date,S=new Date(x),M=Math.floor((_.getTime()-S.getTime())/(1e3*60));return M<1?"방금 전":M<60?`${M}분 전`:M<1440?`${Math.floor(M/60)}시간 전`:`${Math.floor(M/1440)}일 전`},P=x=>{switch(x){case"submission":return"📝";case"evaluation":return"⭐";case"session":return"👤";default:return"📢"}},y=x=>{switch(x.type){case"submission":return`${x.student_name}이 논증문을 제출했습니다`;case"evaluation":return`${x.student_name}이 동료평가를 완료했습니다`;case"session":return`${x.student_name}이 접속했습니다`;default:return"새로운 활동이 있습니다"}};return p.useEffect(()=>{c.length>0&&A()},[c]),p.useEffect(()=>{w.length>0&&(w.forEach(async x=>{try{const{data:_}=await v.from("students").select("name").eq("id",x.student_id).single(),{data:S}=await v.from("activities").select("title").eq("id",x.activity_id).single(),M={id:`submission-${x.id}`,type:"submission",student_name:(_==null?void 0:_.name)||"알 수 없음",activity_title:S==null?void 0:S.title,timestamp:x.submitted_at||new Date().toISOString()};u(j=>[M,...j.slice(0,9)]),i("새 논증문 제출",`${(_==null?void 0:_.name)||"학생"}이 ${(S==null?void 0:S.title)||"활동"}에 논증문을 제출했습니다.`)}catch(_){console.error("Error processing submission:",_)}}),l())},[w,l,i]),p.useEffect(()=>{z.length>0&&(z.forEach(async x=>{try{const{data:_}=await v.from("students").select("name").eq("id",x.evaluator_id).single(),{data:S}=await v.from("activities").select("title").eq("id",x.activity_id).single(),M={id:`evaluation-${x.id}`,type:"evaluation",student_name:(_==null?void 0:_.name)||"알 수 없음",activity_title:S==null?void 0:S.title,timestamp:x.completed_at||new Date().toISOString()};u(j=>[M,...j.slice(0,9)]),d("동료평가 완료",`${(_==null?void 0:_.name)||"학생"}이 ${(S==null?void 0:S.title)||"활동"}의 동료평가를 완료했습니다.`)}catch(_){console.error("Error processing evaluation:",_)}}),b())},[z,b,d]),p.useEffect(()=>{m(h)},[h]),p.useEffect(()=>{A(),g();const x=setInterval(()=>{A(),g()},3e4);return()=>{clearInterval(x)}},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"온라인 학생"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-sm text-gray-500",children:o?"연결됨":"연결 끊김"})]})]})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:s.length>0?s.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x.name}),e.jsx("p",{className:"text-sm text-gray-500",children:x.class_name||"미지정"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(D,{variant:"success",size:"sm",children:"온라인"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:q(x.last_activity)})]})]},x.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"현재 온라인인 학생이 없습니다."})})})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"실시간 채팅 활동"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:r.length>0?r.map(x=>e.jsxs("div",{className:"border-l-4 border-primary-200 pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:x.student_name}),e.jsx("span",{className:"text-xs text-gray-500",children:q(x.created_at)})]}),x.activity_title&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["활동: ",x.activity_title]}),e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:x.message})]},x.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"최근 채팅 메시지가 없습니다."})})})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"실시간 활동 알림"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:a.length>0?a.map(x=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("span",{className:"text-lg",children:P(x.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:y(x)}),x.activity_title&&e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["활동: ",x.activity_title]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:q(x.timestamp)})]})]},x.id)):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"최근 활동 알림이 없습니다."})})})})]})]})}function vs({studentId:s,activityId:t,heartbeatInterval:r=3e4}={}){const n=p.useRef(null),a=p.useRef(null),u=async()=>{if(s)try{const{data:c,error:h}=await v.from("student_sessions").upsert({student_id:s,activity_id:t,is_active:!0,last_activity:new Date().toISOString()}).select().single();if(h)throw h;a.current=c.id,console.log("Session started:",c.id),m()}catch(c){console.error("Error starting session:",c)}},o=async()=>{if(a.current)try{await v.from("student_sessions").update({is_active:!1,ended_at:new Date().toISOString()}).eq("id",a.current),console.log("Session ended:",a.current),a.current=null,d()}catch(c){console.error("Error ending session:",c)}},m=()=>{n.current&&clearInterval(n.current),n.current=setInterval(async()=>{if(a.current)try{await v.from("student_sessions").update({last_activity:new Date().toISOString()}).eq("id",a.current)}catch(c){console.error("Error updating heartbeat:",c)}},r)},d=()=>{n.current&&(clearInterval(n.current),n.current=null)},i=async c=>{if(a.current)try{await v.from("student_sessions").update({activity_id:c,last_activity:new Date().toISOString()}).eq("id",a.current)}catch(h){console.error("Error updating activity:",h)}};return p.useEffect(()=>(s&&u(),()=>{o()}),[s]),p.useEffect(()=>{a.current&&t!==void 0&&i(t)},[t]),p.useEffect(()=>{const c=()=>{a.current&&navigator.sendBeacon(`${v.supabaseUrl}/rest/v1/student_sessions?id=eq.${a.current}`,JSON.stringify({is_active:!1,ended_at:new Date().toISOString()}))},h=()=>{document.visibilityState==="hidden"?d():document.visibilityState==="visible"&&a.current&&m()};return window.addEventListener("beforeunload",c),document.addEventListener("visibilitychange",h),()=>{window.removeEventListener("beforeunload",c),document.removeEventListener("visibilitychange",h)}},[]),{sessionId:a.current,startSession:u,endSession:o,updateActivity:i}}function Pe(){const s=async()=>{try{const r=new Date(Date.now()-18e5).toISOString(),{error:n}=await v.from("student_sessions").update({is_active:!1,ended_at:new Date().toISOString()}).eq("is_active",!0).lt("last_activity",r);if(n)throw n;console.log("Inactive sessions cleaned up")}catch(r){console.error("Error cleaning up sessions:",r)}};return{cleanupInactiveSessions:s,startPeriodicCleanup:(r=10)=>{const n=setInterval(s,r*60*1e3);return s(),()=>clearInterval(n)}}}const Be=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),oe=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),Oe=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),de=()=>e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});function bs(){const[s,t]=p.useState("day"),{data:r,isLoading:n}=ne(),{data:a,isLoading:u}=je(),{data:o,isLoading:m}=fe(s),{startPeriodicCleanup:d}=Pe(),{showInfo:i}=ye();p.useEffect(()=>{const l=d(10);return i("실시간 모니터링","실시간 모니터링이 시작되었습니다."),l},[d,i]);const c=[{label:"대시보드",href:"/admin",icon:e.jsx(oe,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(Be,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(oe,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(Oe,{})},{label:"파일 관리",href:"/admin/files",icon:e.jsx(de,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(de,{})}],h=e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",children:"내보내기"}),e.jsx(N,{size:"sm",children:"새 활동 만들기"})]}),w=[{title:"전체 학생",value:(r==null?void 0:r.length)||0,change:"+12%",changeType:"positive",loading:n},{title:"활성 활동",value:(a==null?void 0:a.filter(l=>l.is_active).length)||0,change:"+5%",changeType:"positive",loading:u},{title:"오늘 채팅",value:(o==null?void 0:o.totalMessages)||0,change:"+23%",changeType:"positive",loading:m},{title:"활성 사용자",value:(o==null?void 0:o.uniqueStudents)||0,change:"+8%",changeType:"positive",loading:m}];return e.jsxs(X,{title:"관리자 대시보드",subtitle:"AI 교육 플랫폼 관리",headerActions:h,sidebarItems:c,showSidebar:!0,children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:w.map((l,z)=>e.jsx(C,{children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:l.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.loading?"...":l.value})]}),e.jsx("div",{className:"text-right",children:e.jsx(D,{variant:l.changeType==="positive"?"success":"error",size:"sm",children:l.change})})]})})},z))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"최근 활동"})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[a==null?void 0:a.slice(0,5).map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.title}),e.jsx("p",{className:"text-sm text-gray-500",children:l.type})]}),e.jsx(D,{variant:l.is_active?"success":"default",children:l.is_active?"활성":"비활성"})]},l.id)),(!a||a.length===0)&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"활동이 없습니다."})]})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"온라인 학생"})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[r==null?void 0:r.slice(0,5).map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:l.class_name||"미지정"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"온라인"})]})]},l.id)),(!r||r.length===0)&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"등록된 학생이 없습니다."})]})})]})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"채팅 활동 통계"}),e.jsx("div",{className:"flex space-x-2",children:["day","week","month"].map(l=>e.jsx(N,{variant:s===l?"primary":"outline",size:"sm",onClick:()=>t(l),children:l==="day"?"오늘":l==="week"?"이번 주":"이번 달"},l))})]})}),e.jsx(L,{children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"통계를 불러오는 중..."})]}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(o==null?void 0:o.totalMessages)||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"총 메시지"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(o==null?void 0:o.totalTokens)||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"사용된 토큰"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(o==null?void 0:o.uniqueStudents)||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"활성 사용자"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(o==null?void 0:o.averageTokensPerMessage)||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"평균 토큰/메시지"})]})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"실시간 모니터링"}),e.jsx($e,{})]})]})}function Z({isOpen:s,onClose:t,title:r,children:n,size:a="md",showCloseButton:u=!0}){if(p.useEffect(()=>{const m=d=>{d.key==="Escape"&&t()};return s&&(document.addEventListener("keydown",m),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",m),document.body.style.overflow="unset"}},[s,t]),!s)return null;const o={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),e.jsxs("div",{className:B("relative bg-white rounded-lg shadow-xl w-full mx-4",o[a]),children:[(r||u)&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r&&e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r}),u&&e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6",children:n})]})]})}const U={images:["image/jpeg","image/jpg","image/png","image/gif","image/webp"],documents:["application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],audio:["audio/mpeg","audio/wav","audio/ogg"],video:["video/mp4","video/webm","video/ogg"]},me={image:5*1024*1024,document:10*1024*1024,audio:20*1024*1024,video:50*1024*1024},We=()=>[...U.images,...U.documents,...U.audio,...U.video],ve=s=>U.images.includes(s)?"image":U.documents.includes(s)?"document":U.audio.includes(s)?"audio":U.video.includes(s)?"video":"unknown",Ue=s=>{const t=ve(s);return me[t]||me.document},R=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB","TB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+r[n]},Ns=s=>{if(!We().includes(s.type))return{isValid:!1,error:`지원되지 않는 파일 형식입니다. (${s.type})`};const r=Ue(s.type);return s.size>r?{isValid:!1,error:`파일 크기가 너무 큽니다. 최대 ${R(r)}까지 업로드 가능합니다.`}:{isValid:!0}},Re=s=>{switch(ve(s)){case"image":return"🖼️";case"document":return s.includes("pdf")?"📄":s.includes("word")?"📝":s.includes("excel")||s.includes("sheet")?"📊":s.includes("powerpoint")||s.includes("presentation")?"📽️":"📄";case"audio":return"🎵";case"video":return"🎬";default:return"📎"}},ee=s=>U.images.includes(s),He=s=>s==="application/pdf",Ke=s=>ee(s)||He(s),ws=s=>new Promise((t,r)=>{if(!ee(s.type)){r(new Error("Not an image file"));return}const n=document.createElement("canvas"),a=n.getContext("2d"),u=new Image;u.onload=()=>{let{width:m,height:d}=u;m>d?m>200&&(d=d*200/m,m=200):d>200&&(m=m*200/d,d=200),n.width=m,n.height=d,a==null||a.drawImage(u,0,0,m,d),t(n.toDataURL("image/jpeg",.8))},u.onerror=()=>r(new Error("Failed to load image")),u.src=URL.createObjectURL(s)}),ks=(s,t=500)=>new Promise((r,n)=>{if(!ee(s.type)){r(s);return}const a=document.createElement("canvas"),u=a.getContext("2d"),o=new Image;o.onload=()=>{let{width:m,height:d}=o;const i=1920;(m>i||d>i)&&(m>d?(d=d*i/m,m=i):(m=m*i/d,d=i)),a.width=m,a.height=d,u==null||u.drawImage(o,0,0,m,d);let c=.9;const h=()=>{a.toBlob(w=>{if(!w){n(new Error("Failed to compress image"));return}if(w.size<=t*1024||c<=.1){const l=new File([w],s.name,{type:s.type,lastModified:Date.now()});r(l)}else c-=.1,h()},s.type,c)};h()},o.onerror=()=>n(new Error("Failed to load image")),o.src=URL.createObjectURL(s)}),F=p.forwardRef(({className:s,label:t,error:r,helperText:n,id:a,...u},o)=>{const m=a||`input-${Math.random().toString(36).substr(2,9)}`;return e.jsxs("div",{className:"w-full",children:[t&&e.jsx("label",{htmlFor:m,className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsx("input",{id:m,className:B("flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:cursor-not-allowed disabled:opacity-50",r&&"border-red-500 focus:ring-red-500 focus:border-red-500",s),ref:o,...u}),r&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r}),n&&!r&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n})]})});F.displayName="Input";const V=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),Ve=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),Qe=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),Ge=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})});function _s(){const[s,t]=p.useState(!1),[r,n]=p.useState(null),[a,u]=p.useState(""),[o,m]=p.useState({name:"",student_id:"",class_name:"",user_id:""}),{data:d,isLoading:i}=ne(),c=Le(),h=ze(),w=Me(),l=[{label:"대시보드",href:"/admin",icon:e.jsx(V,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(V,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(V,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(V,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(V,{})}],z=(d==null?void 0:d.filter(y=>y.name.toLowerCase().includes(a.toLowerCase())||y.student_id.toLowerCase().includes(a.toLowerCase())||y.class_name&&y.class_name.toLowerCase().includes(a.toLowerCase())))||[],b=y=>{y?(n(y),m({name:y.name,student_id:y.student_id,class_name:y.class_name||"",user_id:y.user_id})):(n(null),m({name:"",student_id:"",class_name:"",user_id:""})),t(!0)},A=()=>{t(!1),n(null),m({name:"",student_id:"",class_name:"",user_id:""})},g=async y=>{y.preventDefault();try{r?await h.mutateAsync({id:r.id,...o}):await c.mutateAsync(o),A()}catch(x){console.error("Error saving student:",x)}},q=async y=>{if(window.confirm("정말로 이 학생을 삭제하시겠습니까?"))try{await w.mutateAsync(y)}catch(x){console.error("Error deleting student:",x)}},P=e.jsxs(N,{onClick:()=>b(),children:[e.jsx(Ve,{}),e.jsx("span",{className:"ml-2",children:"학생 추가"})]});return e.jsxs(X,{title:"학생 관리",subtitle:"등록된 학생들을 관리합니다",headerActions:P,sidebarItems:l,showSidebar:!0,children:[e.jsx(C,{className:"mb-6",children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"학생 이름, 학번, 반으로 검색...",value:a,onChange:y=>u(y.target.value)})}),e.jsxs("div",{className:"text-sm text-gray-500",children:["총 ",z.length,"명"]})]})})}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"학생 목록"})}),e.jsx(L,{children:i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"학생 목록을 불러오는 중..."})]}):z.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"학생 정보"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"반"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"상태"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"등록일"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:y.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["학번: ",y.student_id]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-gray-900",children:y.class_name||"미지정"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(D,{variant:"success",children:"활성"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(y.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>b(y),children:e.jsx(Qe,{})}),e.jsx(N,{variant:"destructive",size:"sm",onClick:()=>q(y.id),children:e.jsx(Ge,{})})]})})]},y.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{}),e.jsx("p",{className:"text-gray-500 mt-2",children:a?"검색 결과가 없습니다.":"등록된 학생이 없습니다."})]})})]}),e.jsx(Z,{isOpen:s,onClose:A,title:r?"학생 정보 수정":"새 학생 추가",children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx(F,{label:"학생 이름",value:o.name,onChange:y=>m({...o,name:y.target.value}),required:!0}),e.jsx(F,{label:"학번",value:o.student_id,onChange:y=>m({...o,student_id:y.target.value}),required:!0}),e.jsx(F,{label:"반",value:o.class_name,onChange:y=>m({...o,class_name:y.target.value}),placeholder:"예: 1학년 1반"}),e.jsx(F,{label:"사용자 ID (이메일)",type:"email",value:o.user_id,onChange:y=>m({...o,user_id:y.target.value}),required:!0,helperText:"학생이 로그인할 때 사용할 이메일 주소"}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:A,children:"취소"}),e.jsx(N,{type:"submit",loading:c.isPending||h.isPending,children:r?"수정":"추가"})]})]})})]})}const Q=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),Je=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),Xe=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),Ye=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Ze=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})});function Ss(){const[s,t]=p.useState(!1),[r,n]=p.useState(null),[a,u]=p.useState(""),[o,m]=p.useState("all"),[d,i]=p.useState({title:"",description:"",type:"argumentation",is_active:!0}),{data:c,isLoading:h}=je(),w=Ae(),l=Ie(),z=Ee(),b=[{label:"대시보드",href:"/admin",icon:e.jsx(Q,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(Q,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(Q,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(Q,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(Q,{})}],A=(c==null?void 0:c.filter(j=>{const $=j.title.toLowerCase().includes(a.toLowerCase())||j.description.toLowerCase().includes(a.toLowerCase()),se=o==="all"||j.type===o;return $&&se}))||[],g=j=>{switch(j){case"argumentation":return"논증 활동";case"discussion":return"토론 활동";case"experiment":return"실험 활동";default:return j}},q=j=>{switch(j){case"argumentation":return"info";case"discussion":return"warning";case"experiment":return"success";default:return"default"}},P=j=>{j?(n(j),i({title:j.title,description:j.description,type:j.type,is_active:j.is_active})):(n(null),i({title:"",description:"",type:"argumentation",is_active:!0})),t(!0)},y=()=>{t(!1),n(null),i({title:"",description:"",type:"argumentation",is_active:!0})},x=async j=>{j.preventDefault();try{r?await l.mutateAsync({id:r.id,...d}):await w.mutateAsync(d),y()}catch($){console.error("Error saving activity:",$)}},_=async j=>{if(window.confirm("정말로 이 활동을 삭제하시겠습니까? 관련된 모든 데이터가 삭제됩니다."))try{await z.mutateAsync(j)}catch($){console.error("Error deleting activity:",$)}},S=async j=>{try{await l.mutateAsync({id:j.id,is_active:!j.is_active})}catch($){console.error("Error toggling activity status:",$)}},M=e.jsxs(N,{onClick:()=>P(),children:[e.jsx(Je,{}),e.jsx("span",{className:"ml-2",children:"활동 추가"})]});return e.jsxs(X,{title:"활동 관리",subtitle:"교육 활동을 생성하고 관리합니다",headerActions:M,sidebarItems:b,showSidebar:!0,children:[e.jsx(C,{className:"mb-6",children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"활동 제목, 설명으로 검색...",value:a,onChange:j=>u(j.target.value)})}),e.jsxs("select",{value:o,onChange:j=>m(j.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"all",children:"모든 유형"}),e.jsx("option",{value:"argumentation",children:"논증 활동"}),e.jsx("option",{value:"discussion",children:"토론 활동"}),e.jsx("option",{value:"experiment",children:"실험 활동"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["총 ",A.length,"개"]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"활동 목록을 불러오는 중..."})]}):A.length>0?A.map(j=>e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(E,{className:"text-lg",children:j.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{variant:q(j.type),size:"sm",children:g(j.type)}),e.jsx(D,{variant:j.is_active?"success":"default",size:"sm",children:j.is_active?"활성":"비활성"})]})]})}),e.jsxs(L,{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:j.description}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:["생성일: ",new Date(j.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(N,{variant:j.is_active?"outline":"primary",size:"sm",onClick:()=>S(j),children:[e.jsx(Ze,{}),e.jsx("span",{className:"ml-1",children:j.is_active?"비활성화":"활성화"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>P(j),children:e.jsx(Xe,{})}),e.jsx(N,{variant:"destructive",size:"sm",onClick:()=>_(j.id),children:e.jsx(Ye,{})})]})]})]})]},j.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(Q,{}),e.jsx("p",{className:"text-gray-500 mt-2",children:a||o!=="all"?"검색 결과가 없습니다.":"등록된 활동이 없습니다."})]})}),e.jsx(Z,{isOpen:s,onClose:y,title:r?"활동 수정":"새 활동 추가",size:"lg",children:e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx(F,{label:"활동 제목",value:d.title,onChange:j=>i({...d,title:j.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"활동 설명"}),e.jsx("textarea",{value:d.description,onChange:j=>i({...d,description:j.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"활동에 대한 자세한 설명을 입력하세요...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"활동 유형"}),e.jsxs("select",{value:d.type,onChange:j=>i({...d,type:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,children:[e.jsx("option",{value:"argumentation",children:"논증 활동"}),e.jsx("option",{value:"discussion",children:"토론 활동"}),e.jsx("option",{value:"experiment",children:"실험 활동"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:d.is_active,onChange:j=>i({...d,is_active:j.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-900",children:"활동 활성화"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:y,children:"취소"}),e.jsx(N,{type:"submit",loading:w.isPending||l.isPending,children:r?"수정":"추가"})]})]})})]})}const G=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),es=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),ue=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),ss=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})});function Cs(){const[s,t]=p.useState("day"),[r,n]=p.useState(""),{data:a,isLoading:u}=fe(s),{data:o,isLoading:m}=qe(),{data:d}=ne(),i=[{label:"대시보드",href:"/admin",icon:e.jsx(G,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(ue,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(G,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(G,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(G,{})}],c=(o==null?void 0:o.filter(l=>l.question_text.toLowerCase().includes(r.toLowerCase())))||[],h=l=>{switch(l){case"day":return"오늘";case"week":return"이번 주";case"month":return"이번 달";default:return l}},w=e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",children:"데이터 내보내기"}),e.jsx(N,{size:"sm",children:"실시간 모니터링"})]});return e.jsxs(X,{title:"채팅 모니터링",subtitle:"AI 채팅 활동을 실시간으로 모니터링합니다",headerActions:w,sidebarItems:i,showSidebar:!0,children:[e.jsx(C,{className:"mb-6",children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"통계 기간"}),e.jsx("div",{className:"flex space-x-2",children:["day","week","month"].map(l=>e.jsx(N,{variant:s===l?"primary":"outline",size:"sm",onClick:()=>t(l),children:h(l)},l))})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(C,{children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(G,{})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"총 메시지"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u?"...":(a==null?void 0:a.totalMessages)||0})]})]})})}),e.jsx(C,{children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(es,{})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"사용된 토큰"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u?"...":((a==null?void 0:a.totalTokens)||0).toLocaleString()})]})]})})}),e.jsx(C,{children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ue,{})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"활성 사용자"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u?"...":(a==null?void 0:a.uniqueStudents)||0})]})]})})}),e.jsx(C,{children:e.jsx(L,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ss,{})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"평균 토큰/메시지"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u?"...":(a==null?void 0:a.averageTokensPerMessage)||0})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"AI 모델 사용량"})}),e.jsx(L,{children:u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"데이터를 불러오는 중..."})]}):a!=null&&a.modelUsage?e.jsx("div",{className:"space-y-4",children:Object.entries(a.modelUsage).map(([l,z])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-primary-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[z,"회"]}),e.jsxs(D,{variant:"info",size:"sm",children:[Math.round(z/a.totalMessages*100),"%"]})]})]},l))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"데이터가 없습니다."})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"일별 채팅 활동"})}),e.jsx(L,{children:u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"데이터를 불러오는 중..."})]}):a!=null&&a.dailyActivity?e.jsx("div",{className:"space-y-3",children:Object.entries(a.dailyActivity).sort(([l],[z])=>z.localeCompare(l)).slice(0,7).map(([l,z])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:new Date(l).toLocaleDateString()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full",style:{width:`${Math.min(z/Math.max(...Object.values(a.dailyActivity))*100,100)}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-8 text-right",children:z})]})]},l))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"데이터가 없습니다."})})]})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"자주 묻는 질문"}),e.jsx(F,{placeholder:"질문 검색...",value:r,onChange:l=>n(l.target.value),className:"w-64"})]})}),e.jsx(L,{children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"질문 데이터를 불러오는 중..."})]}):c.length>0?e.jsx("div",{className:"space-y-4",children:c.slice(0,10).map(l=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:l.question_text}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["빈도: ",l.frequency_count,"회"]}),e.jsxs("span",{children:["마지막 질문: ",new Date(l.last_asked).toLocaleDateString()]}),l.students&&e.jsxs("span",{children:["질문자: ",l.students.name]})]})]}),e.jsxs(D,{variant:"info",size:"sm",children:[l.frequency_count,"회"]})]})},l.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{}),e.jsx("p",{className:"text-gray-500 mt-2",children:r?"검색 결과가 없습니다.":"질문 데이터가 없습니다."})]})})]})]})}function ts({className:s}){const[t,r]=p.useState([]),[n,a]=p.useState([]),[u,o]=p.useState(!0),[m,d]=p.useState(""),[i,c]=p.useState("all"),[h,w]=p.useState("date"),[l,z]=p.useState("desc"),[b,A]=p.useState(null),[g,q]=p.useState(new Set);p.useEffect(()=>{P()},[]),p.useEffect(()=>{y()},[t,m,i,h,l]);const P=async()=>{var f,k;try{o(!0);const{data:T,error:O}=await v.storage.from("chat-files").list("",{limit:1e3,offset:0});if(O)throw O;const ce=[];for(const W of T||[])if(W.name!==".emptyFolderPlaceholder")try{const{data:te}=v.storage.from("chat-files").getPublicUrl(W.name),re=W.name.split("/"),le=re[0],{data:ae}=await v.from("students").select("name").eq("id",le).single();ce.push({id:W.name,name:re[re.length-1],size:((f=W.metadata)==null?void 0:f.size)||0,type:((k=W.metadata)==null?void 0:k.mimetype)||"application/octet-stream",url:te.publicUrl,uploadedAt:W.created_at||new Date().toISOString(),studentName:(ae==null?void 0:ae.name)||"알 수 없음",studentId:le,bucket:"chat-files",path:W.name})}catch(te){console.error("Error processing file:",W.name,te)}r(ce)}catch(T){console.error("Error loading files:",T)}finally{o(!1)}},y=()=>{let f=t;m&&(f=f.filter(k=>k.name.toLowerCase().includes(m.toLowerCase())||k.studentName.toLowerCase().includes(m.toLowerCase()))),i!=="all"&&(f=f.filter(k=>{switch(i){case"image":return k.type.startsWith("image/");case"document":return k.type.includes("pdf")||k.type.includes("document")||k.type.includes("text");case"audio":return k.type.startsWith("audio/");case"video":return k.type.startsWith("video/");default:return!0}})),f.sort((k,T)=>{let O=0;switch(h){case"name":O=k.name.localeCompare(T.name);break;case"size":O=k.size-T.size;break;case"date":O=new Date(k.uploadedAt).getTime()-new Date(T.uploadedAt).getTime();break;case"student":O=k.studentName.localeCompare(T.studentName);break}return l==="asc"?O:-O}),a(f)},x=f=>{h===f?z(l==="asc"?"desc":"asc"):(w(f),z("asc"))},_=f=>{q(k=>{const T=new Set(k);return T.has(f)?T.delete(f):T.add(f),T})},S=()=>{g.size===n.length?q(new Set):q(new Set(n.map(f=>f.id)))},M=async()=>{if(g.size!==0&&window.confirm(`선택한 ${g.size}개의 파일을 삭제하시겠습니까?`))try{const f=Array.from(g),{error:k}=await v.storage.from("chat-files").remove(f);if(k)throw k;alert("선택한 파일들이 삭제되었습니다."),q(new Set),await P()}catch(f){console.error("Error deleting files:",f),alert("파일 삭제 중 오류가 발생했습니다.")}},j=f=>{const k=document.createElement("a");k.href=f.url,k.download=f.name,document.body.appendChild(k),k.click(),document.body.removeChild(k)},$=()=>t.reduce((f,k)=>f+k.size,0),se=()=>t.filter(f=>g.has(f.id)).reduce((f,k)=>f+k.size,0);return u?e.jsxs(C,{className:s,children:[e.jsx(I,{children:e.jsx(E,{children:"파일 관리"})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"파일 목록을 불러오는 중..."})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{className:s,children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"파일 관리"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(D,{variant:"info",children:["총 ",t.length,"개 파일 (",R($()),")"]}),g.size>0&&e.jsxs(N,{variant:"destructive",size:"sm",onClick:M,children:["선택 삭제 (",g.size,")"]})]})]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"파일명 또는 학생명으로 검색...",value:m,onChange:f=>d(f.target.value)})}),e.jsxs("select",{value:i,onChange:f=>c(f.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"all",children:"모든 파일"}),e.jsx("option",{value:"image",children:"이미지"}),e.jsx("option",{value:"document",children:"문서"}),e.jsx("option",{value:"audio",children:"오디오"}),e.jsx("option",{value:"video",children:"비디오"})]})]}),n.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:g.size===n.length&&n.length>0,onChange:S,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>x("name"),children:["파일명 ",h==="name"&&(l==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>x("student"),children:["업로드한 학생 ",h==="student"&&(l==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>x("size"),children:["크기 ",h==="size"&&(l==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>x("date"),children:["업로드 날짜 ",h==="date"&&(l==="asc"?"↑":"↓")]}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:g.has(f.id),onChange:()=>_(f.id),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:Re(f.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate max-w-xs",children:f.name}),e.jsx("div",{className:"text-sm text-gray-500",children:f.type})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:f.studentName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R(f.size)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(f.uploadedAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[Ke(f.type)&&e.jsx(N,{variant:"outline",size:"sm",onClick:()=>A(f),children:"미리보기"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>j(f),children:"다운로드"})]})})]},f.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-500 mt-4",children:m||i!=="all"?"검색 조건에 맞는 파일이 없습니다.":"업로드된 파일이 없습니다."})]}),g.size>0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[g.size,"개 파일 선택됨 (",R(se()),")"]})})]})]}),b&&e.jsxs(Z,{isOpen:!0,onClose:()=>A(null),title:b.name,size:"xl",children:[e.jsx("div",{className:"max-h-96 overflow-auto",children:ee(b.type)?e.jsx("img",{src:b.url,alt:b.name,className:"max-w-full h-auto mx-auto"}):b.type==="application/pdf"?e.jsx("iframe",{src:b.url,className:"w-full h-96",title:b.name}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500",children:"미리보기를 지원하지 않는 파일 형식입니다."}),e.jsx(N,{className:"mt-4",onClick:()=>j(b),children:"파일 다운로드"})]})}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"업로드한 학생:"})," ",b.studentName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"파일 크기:"})," ",R(b.size)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"파일 형식:"})," ",b.type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"업로드 날짜:"})," ",new Date(b.uploadedAt).toLocaleString()]})]})})]})]})}function rs({className:s}){const[t,r]=p.useState({totalFiles:0,totalSize:0,byType:{},byStudent:{},recentUploads:[]}),[n,a]=p.useState(!0);p.useEffect(()=>{u()},[]);const u=async()=>{var i,c;try{a(!0);const{data:h,error:w}=await v.storage.from("chat-files").list("",{limit:1e3,offset:0});if(w)throw w;const l={totalFiles:0,totalSize:0,byType:{},byStudent:{},recentUploads:[]},z=[],b=new Map;for(const A of h||[]){if(A.name===".emptyFolderPlaceholder")continue;const g=((i=A.metadata)==null?void 0:i.size)||0,q=((c=A.metadata)==null?void 0:c.mimetype)||"application/octet-stream",P=A.created_at||new Date().toISOString(),y=A.name.split("/"),x=y[0],_=y[y.length-1];let S=b.get(x);if(!S)try{const{data:j}=await v.from("students").select("name").eq("id",x).single();S=(j==null?void 0:j.name)||"알 수 없음",b.set(x,S)}catch{S="알 수 없음",b.set(x,S)}l.totalFiles++,l.totalSize+=g;const M=o(q);l.byType[M]||(l.byType[M]={count:0,size:0}),l.byType[M].count++,l.byType[M].size+=g,l.byStudent[x]||(l.byStudent[x]={count:0,size:0,name:S}),l.byStudent[x].count++,l.byStudent[x].size+=g,z.push({name:_,size:g,uploadedAt:P,studentName:S})}z.sort((A,g)=>new Date(g.uploadedAt).getTime()-new Date(A.uploadedAt).getTime()),l.recentUploads=z.slice(0,10),r(l)}catch(h){console.error("Error loading storage stats:",h)}finally{a(!1)}},o=i=>i.startsWith("image/")?"이미지":i.includes("pdf")?"PDF":i.includes("document")||i.includes("word")?"문서":i.includes("spreadsheet")||i.includes("excel")?"스프레드시트":i.includes("presentation")||i.includes("powerpoint")?"프레젠테이션":i.startsWith("audio/")?"오디오":i.startsWith("video/")?"비디오":i.includes("text")?"텍스트":"기타",m=()=>t.totalSize/1073741824*100,d=()=>Object.entries(t.byStudent).sort(([,i],[,c])=>c.size-i.size).slice(0,5);return n?e.jsxs(C,{className:s,children:[e.jsx(I,{children:e.jsx(E,{children:"스토리지 사용량"})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"통계를 불러오는 중..."})]})})]}):e.jsxs("div",{className:`space-y-6 ${s}`,children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"전체 스토리지 사용량"})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"사용량"}),e.jsx("span",{className:"text-lg font-semibold",children:R(t.totalSize)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${m()>80?"bg-red-500":m()>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(m(),100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[t.totalFiles,"개 파일"]}),e.jsxs("span",{children:[m().toFixed(1),"% 사용"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"파일 타입별 사용량"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(t.byType).sort(([,i],[,c])=>c.size-i.size).map(([i,c])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i}),e.jsxs(D,{variant:"info",size:"sm",children:[c.count,"개"]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:R(c.size)})]},i))})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"학생별 사용량 TOP 5"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3",children:d().map(([i,c],h)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 w-4",children:["#",h+1]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:c.name}),e.jsxs(D,{variant:"info",size:"sm",children:[c.count,"개"]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:R(c.size)})]},i))})})]})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"최근 업로드"})}),e.jsx(L,{children:t.recentUploads.length>0?e.jsx("div",{className:"space-y-3",children:t.recentUploads.map((i,c)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:i.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.studentName," • ",R(i.size)]})]}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:new Date(i.uploadedAt).toLocaleDateString()})]},c))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"최근 업로드된 파일이 없습니다."})})]}),e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"💡 스토리지 관리 팁"})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"용량 절약"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 이미지는 자동으로 압축됩니다"}),e.jsx("li",{children:"• 불필요한 파일은 정기적으로 삭제하세요"}),e.jsx("li",{children:"• 큰 비디오 파일은 외부 링크를 활용하세요"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"모니터링"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 사용량이 80%를 넘으면 주의하세요"}),e.jsx("li",{children:"• 학생별 사용량을 정기적으로 확인하세요"}),e.jsx("li",{children:"• 파일 타입별 분포를 모니터링하세요"})]})]})]})})]})]})}const as=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-5l-2-2H5a2 2 0 00-2 2z"})}),ns=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),xe=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),is=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),cs=()=>e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});function Ls(){const[s,t]=p.useState("files"),r=[{label:"대시보드",href:"/admin",icon:e.jsx(xe,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(ns,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(xe,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(is,{})},{label:"파일 관리",href:"/admin/files",icon:e.jsx(as,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(cs,{})}],n=e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",children:"스토리지 정리"}),e.jsx(N,{size:"sm",children:"백업 생성"})]});return e.jsxs(X,{title:"파일 관리",subtitle:"업로드된 파일들을 관리하고 스토리지 사용량을 모니터링합니다",headerActions:n,sidebarItems:r,showSidebar:!0,children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>t("files"),className:`py-2 px-1 border-b-2 font-medium text-sm ${s==="files"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"파일 목록"}),e.jsx("button",{onClick:()=>t("storage"),className:`py-2 px-1 border-b-2 font-medium text-sm ${s==="storage"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"스토리지 모니터링"})]})})}),s==="files"&&e.jsx(ts,{}),s==="storage"&&e.jsx(rs,{})]})}const Y=()=>e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),ls=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),he=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),pe=()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})});function zs(){const[s,t]=p.useState("global"),[r,n]=p.useState(!1),[a,u]=p.useState("prompt"),[o,m]=p.useState(null),[d,i]=p.useState({default_ai_model:"gpt-3.5-turbo",default_temperature:.7,default_max_tokens:1e3,enable_rag:!0,max_chat_history:50,session_timeout_minutes:30}),[c]=p.useState([{id:"1",class_name:"기본반",activity_type:"argumentation",prompt_template:"논증 활동을 도와주는 AI입니다.",ai_model:"gpt-3.5-turbo",temperature:.7,max_tokens:1e3},{id:"2",class_name:"기본반",activity_type:"discussion",prompt_template:"토론 활동을 촉진하는 AI입니다.",ai_model:"gpt-3.5-turbo",temperature:.8,max_tokens:1e3}]),[h]=p.useState([{id:"1",name:"argumentation_assistant",template:"당신은 학생들의 논증 활동을 도와주는 AI 교육 도우미입니다.",description:"논증 활동용 기본 프롬프트",variables:["question","activity_title","student_name"]},{id:"2",name:"discussion_facilitator",template:"당신은 토론 활동을 촉진하는 AI 교육 도우미입니다.",description:"토론 활동용 기본 프롬프트",variables:["question","activity_title","student_name"]}]),w=[{label:"대시보드",href:"/admin",icon:e.jsx(Y,{})},{label:"학생 관리",href:"/admin/students",icon:e.jsx(Y,{})},{label:"활동 관리",href:"/admin/activities",icon:e.jsx(Y,{})},{label:"채팅 모니터링",href:"/admin/chat",icon:e.jsx(Y,{})},{label:"AI 설정",href:"/admin/settings",icon:e.jsx(Y,{})}],l=()=>{console.log("Saving global settings:",d),alert("설정이 저장되었습니다.")},z=g=>{switch(g){case"argumentation":return"논증 활동";case"discussion":return"토론 활동";case"experiment":return"실험 활동";default:return g}},b=g=>{switch(g){case"argumentation":return"info";case"discussion":return"warning";case"experiment":return"success";default:return"default"}},A=e.jsx("div",{className:"flex space-x-2",children:s!=="global"&&e.jsxs(N,{onClick:()=>n(!0),children:[e.jsx(ls,{}),e.jsx("span",{className:"ml-2",children:s==="prompts"?"프롬프트 추가":"템플릿 추가"})]})});return e.jsxs(X,{title:"AI 설정",subtitle:"AI 모델과 프롬프트를 관리합니다",headerActions:A,sidebarItems:w,showSidebar:!0,children:[e.jsx(C,{className:"mb-6",children:e.jsx(L,{padding:"none",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:[{key:"global",label:"전역 설정"},{key:"prompts",label:"클래스별 프롬프트"},{key:"templates",label:"프롬프트 템플릿"}].map(g=>e.jsx("button",{onClick:()=>t(g.key),className:`py-4 px-1 border-b-2 font-medium text-sm ${s===g.key?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:g.label},g.key))})})})}),s==="global"&&e.jsxs(C,{children:[e.jsx(I,{children:e.jsx(E,{children:"전역 AI 설정"})}),e.jsxs(L,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"기본 AI 모델"}),e.jsxs("select",{value:d.default_ai_model,onChange:g=>i({...d,default_ai_model:g.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"}),e.jsx("option",{value:"gpt-4",children:"GPT-4"}),e.jsx("option",{value:"claude-3-sonnet",children:"Claude 3 Sonnet"}),e.jsx("option",{value:"claude-3-haiku",children:"Claude 3 Haiku"})]})]}),e.jsx(F,{label:"기본 온도 (Temperature)",type:"number",min:"0",max:"2",step:"0.1",value:d.default_temperature,onChange:g=>i({...d,default_temperature:parseFloat(g.target.value)}),helperText:"0.0 (결정적) ~ 2.0 (창의적)"}),e.jsx(F,{label:"기본 최대 토큰 수",type:"number",min:"100",max:"4000",value:d.default_max_tokens,onChange:g=>i({...d,default_max_tokens:parseInt(g.target.value)})}),e.jsx(F,{label:"최대 채팅 기록 수",type:"number",min:"10",max:"200",value:d.max_chat_history,onChange:g=>i({...d,max_chat_history:parseInt(g.target.value)})}),e.jsx(F,{label:"세션 타임아웃 (분)",type:"number",min:"5",max:"120",value:d.session_timeout_minutes,onChange:g=>i({...d,session_timeout_minutes:parseInt(g.target.value)})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"enable_rag",checked:d.enable_rag,onChange:g=>i({...d,enable_rag:g.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"enable_rag",className:"ml-2 block text-sm text-gray-900",children:"RAG (문서 검색) 기능 활성화"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx(N,{onClick:l,children:"설정 저장"})})]})]}),s==="prompts"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:c.map(g=>e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{className:"text-lg",children:g.class_name}),e.jsx(D,{variant:b(g.activity_type),size:"sm",children:z(g.activity_type)})]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"AI 모델"}),e.jsx("p",{className:"text-sm text-gray-600",children:g.ai_model})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"온도"}),e.jsx("p",{className:"text-sm text-gray-600",children:g.temperature})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"최대 토큰"}),e.jsx("p",{className:"text-sm text-gray-600",children:g.max_tokens})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"프롬프트"}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:g.prompt_template})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4 pt-4 border-t border-gray-200",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{m(g),u("prompt"),n(!0)},children:e.jsx(he,{})}),e.jsx(N,{variant:"destructive",size:"sm",children:e.jsx(pe,{})})]})]})]},g.id))}),s==="templates"&&e.jsx("div",{className:"space-y-6",children:h.map(g=>e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:g.name}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{m(g),u("template"),n(!0)},children:e.jsx(he,{})}),e.jsx(N,{variant:"destructive",size:"sm",children:e.jsx(pe,{})})]})]})}),e.jsxs(L,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:g.description}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-gray-800 font-mono",children:g.template})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"사용 가능한 변수:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.variables.map(q=>e.jsx(D,{variant:"info",size:"sm",children:`{${q}}`},q))})]})]})]},g.id))}),e.jsx(Z,{isOpen:r,onClose:()=>{n(!1),m(null)},title:`${a==="prompt"?"프롬프트":"템플릿"} ${o?"수정":"추가"}`,size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:[a==="prompt"?"클래스별 프롬프트":"프롬프트 템플릿"," 기능은 개발 중입니다."]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{variant:"outline",onClick:()=>{n(!1),m(null)},children:"취소"}),e.jsx(N,{children:o?"수정":"추가"})]})]})})]})}export{us as A,D as B,C,Ls as F,F as I,X as L,Z as M,_s as S,hs as a,js as b,L as c,I as d,E as e,N as f,gs as g,fs as h,ys as i,ee as j,ws as k,ks as l,He as m,Ke as n,R as o,_e as p,vs as q,ps as r,v as s,ze as t,xs as u,Ns as v,bs as w,Ss as x,Cs as y,zs as z};
